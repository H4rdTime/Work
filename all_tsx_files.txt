/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';
import {useLayoutEffect, useMemo, useRef, useState} from 'preact/hooks';

import {Sidebar} from './sidebar/sidebar';
import {Summary} from './summary/summary';
import {classNames, FlowResultContext, OptionsContext, useHashState} from './util';
import {Report} from './wrappers/report';
import {Topbar} from './topbar';
import {Header} from './header';
import {I18nProvider} from './i18n/i18n';
import {Styles} from './wrappers/styles';

function getAnchorElement(hashState: LH.HashState|null) {
  if (!hashState || !hashState.anchor) return null;
  return document.getElementById(hashState.anchor);
}

const Content: FunctionComponent = () => {
  const hashState = useHashState();
  const ref = useRef<HTMLDivElement>(null);

  useLayoutEffect(() => {
    const el = getAnchorElement(hashState);
    if (el) {
      el.scrollIntoView();
    } else if (ref.current) {
      ref.current.scrollTop = 0;
    }
  }, [hashState]);

  return (
    <div ref={ref} className="Content">
      {
        hashState ?
          <>
            <Header hashState={hashState}/>
            <Report hashState={hashState}/>
          </> :
          <Summary/>
      }
    </div>
  );
};

export const App: FunctionComponent<{
  flowResult: LH.FlowResult,
  options?: LH.FlowReportOptions
}> = ({flowResult, options}) => {
  const [collapsed, setCollapsed] = useState(false);
  const optionsValue = useMemo(() => options || {}, [options]);
  return (
    <OptionsContext.Provider value={optionsValue}>
      <FlowResultContext.Provider value={flowResult}>
        <I18nProvider>
          <Styles/>
          <div className={classNames('App', {'App--collapsed': collapsed})} data-testid="App">
            <Topbar onMenuClick={() => setCollapsed(c => !c)} />
            <Sidebar/>
            <Content/>
          </div>
        </I18nProvider>
      </FlowResultContext.Provider>
    </OptionsContext.Provider>
  );
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';
import {useEffect, useState} from 'preact/hooks';

import {NavigationIcon, SnapshotIcon, TimespanIcon} from './icons';
import {getFilmstripFrames, getScreenDimensions} from './util';
import {Util} from '../../shared/util.js';

const ANIMATION_FRAME_DURATION_MS = 500;

const Separator: FunctionComponent = () => {
  return <div className="Separator" role="separator"></div>;
};

const FlowStepIcon: FunctionComponent<{mode: LH.Result.GatherMode}> = ({mode}) => {
  return <>
    {
      mode === 'navigation' && <NavigationIcon/>
    }
    {
      mode === 'timespan' && <TimespanIcon/>
    }
    {
      mode === 'snapshot' && <SnapshotIcon/>
    }
  </>;
};

const FlowSegment: FunctionComponent<{mode?: LH.Result.GatherMode}> = ({mode}) => {
  return (
    <div className="FlowSegment">
      <div className="FlowSegment__top-line"/>
      {
        mode && <FlowStepIcon mode={mode}/>
      }
      <div className="FlowSegment__bottom-line"/>
    </div>
  );
};

const FlowStepAnimatedThumbnail: FunctionComponent<{
  frames: Array<{data: string}>,
  width: number,
  height: number,
}> = ({frames, width, height}) => {
  const [frameIndex, setFrameIndex] = useState(0);
  // Handle a frame array of a different length being set.
  const effectiveFrameIndex = frameIndex % frames.length;

  useEffect(() => {
    const interval = setInterval(
      () => setFrameIndex(i => (i + 1) % frames.length),
      ANIMATION_FRAME_DURATION_MS
    );

    return () => clearInterval(interval);
  }, [frames.length]);

  return (
    <img
      className="FlowStepThumbnail"
      data-testid="FlowStepAnimatedThumbnail"
      src={frames[effectiveFrameIndex].data}
      style={{width, height}}
      alt="Animated screenshots of a page tested by Lighthouse"
    />
  );
};

const FlowStepThumbnail: FunctionComponent<{
  lhr: LH.Result,
  width?: number,
  height?: number,
}> = ({lhr, width, height}) => {
  const frames = getFilmstripFrames(lhr);

  // Resize the image to fit the viewport aspect ratio.
  const dimensions = getScreenDimensions(lhr);
  if (width && height === undefined) {
    height = dimensions.height * width / dimensions.width;
  } else if (height && width === undefined) {
    width = dimensions.width * height / dimensions.height;
  }

  if (!width || !height) {
    console.warn(new Error('FlowStepThumbnail requested without any dimensions').stack);
    return <></>;
  }

  let thumbnail;
  if (frames?.length) {
    thumbnail = frames[frames.length - 1].data;
    if (lhr.gatherMode === 'timespan') {
      return <FlowStepAnimatedThumbnail frames={frames} width={width} height={height} />;
    }
  } else {
    thumbnail = Util.getFullPageScreenshot(lhr)?.screenshot.data;
  }

  return <>
    {
      thumbnail &&
        <img
          className="FlowStepThumbnail"
          src={thumbnail}
          style={{width, height}}
          alt="Screenshot of a page tested by Lighthouse"
        />
    }
  </>;
};

export {
  Separator,
  FlowStepIcon,
  FlowSegment,
  FlowStepThumbnail,
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

import {FlowStepIcon, FlowStepThumbnail} from './common';
import {useLocalizedStrings} from './i18n/i18n';
import {getModeDescription, useFlowResult} from './util';

const SIDE_THUMBNAIL_HEIGHT = 80;
const MAIN_THUMBNAIL_HEIGHT = 120;

const HeaderThumbnail: FunctionComponent<{
  lhr: LH.Result,
  position: 'prev'|'next'|'main'
}> =
({lhr, position}) => {
  const height = position === 'main' ? MAIN_THUMBNAIL_HEIGHT : SIDE_THUMBNAIL_HEIGHT;
  return (
    <div className={`HeaderThumbnail HeaderThumbnail--${position}`}>
      <FlowStepThumbnail lhr={lhr} height={height}/>
      <div className="HeaderThumbnail__icon">
        <FlowStepIcon mode={lhr.gatherMode}/>
      </div>
    </div>
  );
};

export const Header: FunctionComponent<{hashState: LH.HashState}> =
({hashState}) => {
  const flowResult = useFlowResult();
  const {index} = hashState;

  const step = flowResult.steps[index];
  const prevStep = flowResult.steps[index - 1];
  const nextStep = flowResult.steps[index + 1];

  const strings = useLocalizedStrings();
  const modeDescription = getModeDescription(step.lhr.gatherMode, strings);

  return (
    <div className="Header">
      {
        prevStep && <>
          {
            flowResult.steps[index - 2] && <div className="Header__segment"/>
          }
          <div className="Header__prev-thumbnail">
            <HeaderThumbnail lhr={prevStep.lhr} position="prev"/>
            <div className="Header__segment"/>
          </div>
          <a
            className="Header__prev-title"
            href={`#index=${index - 1}`}
          >{prevStep.name}</a>
        </>
      }
      <div className="Header__current-thumbnail">
        <HeaderThumbnail lhr={step.lhr} position="main"/>
      </div>
      <div className="Header__current-title">
        {step.name}
        <div className="Header__current-description">
          {modeDescription}
        </div>
      </div>
      {
        nextStep && <>
          <div className="Header__next-thumbnail">
            <div className="Header__segment"/>
            <HeaderThumbnail lhr={nextStep.lhr} position="next"/>
          </div>
          <a
            className="Header__next-title"
            href={`#index=${index + 1}`}
          >{nextStep.name}</a>
          {
            flowResult.steps[index + 2] && <div className="Header__segment"/>
          }
        </>
      }
    </div>
  );
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent, JSX} from 'preact';

import {useLocalizedStrings} from './i18n/i18n';
import {CloseIcon, NavigationIcon, SnapshotIcon, TimespanIcon} from './icons';

const HelpDialogColumn: FunctionComponent<{
  icon: JSX.Element,
  userFriendlyModeLabel: string;
  lighthouseOfficialModeLabel: string;
  modeDescription: string;
  useCaseInstruction: string;
  useCases: string[];
  availableCategories: string[];
}> = (props) => {
  const strings = useLocalizedStrings();

  return (
    <div className="HelpDialogColumn">
      <div className="HelpDialogColumn__legend">
        <div className="HelpDialogColumnTimeline">
          {props.icon}
          <div className="HelpDialogColumnTimeline__line" />
        </div>
        <div className="HelpDialogColumn__legend-label">{props.userFriendlyModeLabel}</div>
      </div>
      <div className="HelpDialogColumn__header">
        <div className="HelpDialogColumn__header-title">{props.lighthouseOfficialModeLabel}</div>
        <p>{props.modeDescription}</p>
      </div>
      <div className="HelpDialogColumn__use-cases">
        <p>{props.useCaseInstruction}</p>
        <ul>
          {props.useCases.map((useCase, i) => (
            <li key={i}>{useCase}</li>
          ))}
        </ul>
      </div>
      <div className="HelpDialogColumn__categories">
        <p>{strings.categories}</p>
        <ul>
          {props.availableCategories.map((category, i) => (
            <li key={i}>{category}</li>
          ))}
        </ul>
      </div>
    </div>
  );
};

export const HelpDialog: FunctionComponent<{onClose: () => void}> = ({
  onClose,
}) => {
  const strings = useLocalizedStrings();

  return (
    <div className="HelpDialog">
      <div className="HelpDialog__title">
        <div>{strings.helpDialogTitle}</div>
        <div style={{flexGrow: 1}} />
        <button className="HelpDialog__close" onClick={onClose}>
          <CloseIcon />
        </button>
      </div>
      <div className="HelpDialog__columns">
        <HelpDialogColumn
          icon={<NavigationIcon />}
          userFriendlyModeLabel={strings.navigationDescription}
          lighthouseOfficialModeLabel={strings.navigationReport}
          modeDescription={strings.navigationLongDescription}
          useCaseInstruction={strings.helpUseCaseInstructionNavigation}
          useCases={[
            strings.helpUseCaseNavigation1,
            strings.helpUseCaseNavigation2,
            strings.helpUseCaseNavigation3,
          ]}
          availableCategories={[
            strings.categoryPerformance,
            strings.categoryAccessibility,
            strings.categoryBestPractices,
            strings.categorySeo,
          ]}
        />
        <HelpDialogColumn
          icon={<TimespanIcon />}
          userFriendlyModeLabel={strings.timespanDescription}
          lighthouseOfficialModeLabel={strings.timespanReport}
          modeDescription={strings.timespanLongDescription}
          useCaseInstruction={strings.helpUseCaseInstructionTimespan}
          useCases={[strings.helpUseCaseTimespan1, strings.helpUseCaseTimespan2]}
          availableCategories={[
            strings.categoryPerformance,
            strings.categoryBestPractices,
          ]}
        />
        <HelpDialogColumn
          icon={<SnapshotIcon />}
          userFriendlyModeLabel={strings.snapshotDescription}
          lighthouseOfficialModeLabel={strings.snapshotReport}
          modeDescription={strings.snapshotLongDescription}
          useCaseInstruction={strings.helpUseCaseInstructionSnapshot}
          useCases={[strings.helpUseCaseSnapshot1, strings.helpUseCaseSnapshot2]}
          availableCategories={[
            strings.categoryPerformance,
            strings.categoryAccessibility,
            strings.categoryBestPractices,
            strings.categorySeo,
          ]}
        />
      </div>
    </div>
  );
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

/* eslint-disable max-len */

const SummaryIcon: FunctionComponent = () => {
  return (
    <svg width="14" viewBox="0 0 18 16" fill="none" role="img">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M0 2C0 1.17 0.67 0.5 1.5 0.5C2.33 0.5 3 1.17 3 2C3 2.83 2.33 3.5 1.5 3.5C0.67 3.5 0 2.83 0 2ZM0 8C0 7.17 0.67 6.5 1.5 6.5C2.33 6.5 3 7.17 3 8C3 8.83 2.33 9.5 1.5 9.5C0.67 9.5 0 8.83 0 8ZM1.5 12.5C0.67 12.5 0 13.18 0 14C0 14.82 0.68 15.5 1.5 15.5C2.32 15.5 3 14.82 3 14C3 13.18 2.33 12.5 1.5 12.5ZM18 15H5V13H18V15ZM5 9H18V7H5V9ZM5 3V1H18V3H5Z" fill="currentColor"/>
    </svg>
  );
};

const NavigationIcon: FunctionComponent = () => {
  return (
    <svg
      width="16"
      height="16"
      viewBox="0 0 16 16"
      fill="none"
      role="img"
      aria-label="Icon representing a navigation report">
      <circle
        cx="8"
        cy="8"
        r="7"
        fill="none"
        stroke="currentColor"
        stroke-width="2"/>
    </svg>
  );
};

const TimespanIcon: FunctionComponent = () => {
  return (
    <svg
      width="16"
      height="16"
      viewBox="0 0 16 16"
      fill="none"
      role="img"
      aria-label="Icon representing a timespan report">
      <circle
        cx="8"
        cy="8"
        r="7"
        fill="none"
        stroke="currentColor"
        stroke-width="2"/>
      <path
        d="m 8,4 v 4 l 4,1.9999998"
        stroke="currentColor"
        stroke-width="1.5"/>
    </svg>
  );
};

const SnapshotIcon: FunctionComponent = () => {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
      viewBox="0 0 16 16"
      fill="none"
      role="img"
      aria-label="Icon representing a snapshot report">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M 12.2038,12.2812 C 11.1212,13.3443 9.6372,14 8,14 7.81038,14 7.62281,13.9912 7.43768,13.974 L 10.3094,9 Z M 12.8925,11.4741 10.0207,6.5 H 13.811 C 13.9344,6.97943 14,7.48205 14,8 c 0,1.2947 -0.4101,2.4937 -1.1075,3.4741 z M 13.456,5.5 H 7.71135 L 9.6065,2.21749 C 11.3203,2.69259 12.7258,3.90911 13.456,5.5 Z M 8.5624,2.02601 C 8.3772,2.0088 8.1896,2 8,2 6.36282,2 4.8788,2.65572 3.79622,3.71885 L 5.69061,7.00002 Z M 3.10749,4.52594 C 2.4101,5.5063 2,6.70526 2,8 2,8.5179 2.06563,9.0206 2.18903,9.5 H 5.97927 Z M 2.54404,10.5 c 0.73017,1.5909 2.1357,2.8074 3.84949,3.2825 L 8.2887,10.5 Z M 16,8 c 0,4.4183 -3.5817,8 -8,8 C 3.58172,16 0,12.4183 0,8 0,3.58172 3.58172,0 8,0 c 4.4183,0 8,3.58172 8,8 z"
        fill="currentColor"/>
    </svg>
  );
};

const CloseIcon: FunctionComponent = () => {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      height="24px"
      viewBox="0 0 24 24"
      width="24px"
      fill="currentColor"
      role="img"
      aria-label="Icon representing a close action"
    >
      <path d="M0 0h24v24H0V0z" fill="none" />
      <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" />
    </svg>
  );
};

const EnvIcon: FunctionComponent = () => {
  return (
    <svg width="15" height="12" viewBox="0 0 15 12" fill="none" role="img">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M3.33317 2.00008H13.9998V0.666748H3.33317C2.59984 0.666748 1.99984 1.26675 1.99984 2.00008V9.33341H0.666504V11.3334H7.99984V9.33341H3.33317V2.00008ZM13.9998 3.33341H9.99984C9.63317 3.33341 9.33317 3.63341 9.33317 4.00008V10.6667C9.33317 11.0334 9.63317 11.3334 9.99984 11.3334H13.9998C14.3665 11.3334 14.6665 11.0334 14.6665 10.6667V4.00008C14.6665 3.63341 14.3665 3.33341 13.9998 3.33341ZM10.6665 9.33341H13.3332V4.66675H10.6665V9.33341Z" fill="currentColor"/>
    </svg>
  );
};

const NetworkIcon: FunctionComponent = () => {
  return (
    <svg width="16" height="11" viewBox="0 0 16 11" fill="none" role="img">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M0.666687 3.26663L2.00002 4.59997C3.92002 2.67997 6.52669 1.87997 9.02002 2.18663L9.81335 0.399966C6.59335 -0.173367 3.16002 0.779966 0.666687 3.26663ZM10.6 0.599966C10.4867 0.599966 10.3867 0.659966 10.3267 0.753299L10.28 0.853299L6.82669 8.61996C6.72002 8.8133 6.65335 9.02663 6.65335 9.25996C6.65335 9.99996 7.25335 10.6 7.99335 10.6C8.63335 10.6 9.17335 10.1466 9.30002 9.53996L9.30669 9.51997L10.9334 0.933299C10.9334 0.746633 10.7867 0.599966 10.6 0.599966ZM15.3334 3.26663L14 4.59997C13.1867 3.78663 12.2534 3.17997 11.2534 2.76663L11.6067 0.886633C12.9667 1.38663 14.24 2.1733 15.3334 3.26663ZM11.3334 7.26663L12.6667 5.9333C12.1334 5.39997 11.5334 4.98663 10.8934 4.6733L10.5267 6.61997C10.8067 6.79997 11.08 7.0133 11.3334 7.26663ZM4.66669 7.26663L3.33335 5.9333C4.67335 4.5933 6.45335 3.95997 8.20669 4.0133L7.35335 5.9333C6.37335 6.0733 5.42002 6.5133 4.66669 7.26663Z" fill="currentColor"/>
    </svg>
  );
};

const CpuIcon: FunctionComponent = () => {
  return (
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" role="img">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M15.5 7.16667V5.5H13.8333V3.83333C13.8333 2.91667 13.0833 2.16667 12.1667 2.16667H10.5V0.5H8.83333V2.16667H7.16667V0.5H5.5V2.16667H3.83333C2.91667 2.16667 2.16667 2.91667 2.16667 3.83333V5.5H0.5V7.16667H2.16667V8.83333H0.5V10.5H2.16667V12.1667C2.16667 13.0833 2.91667 13.8333 3.83333 13.8333H5.5V15.5H7.16667V13.8333H8.83333V15.5H10.5V13.8333H12.1667C13.0833 13.8333 13.8333 13.0833 13.8333 12.1667V10.5H15.5V8.83333H13.8333V7.16667H15.5ZM10.5 5.5H5.5V10.5H10.5V5.5ZM3.83333 12.1667H12.1667V3.83333H3.83333V12.1667Z" fill="currentColor"/>
    </svg>
  );
};

const HamburgerIcon: FunctionComponent = () => {
  return (
    <svg viewBox="0 0 18 12" width="18" height="12" role="img">
      <rect width="18" height="2" fill="currentColor"></rect>
      <rect y="5" width="18" height="2" fill="currentColor"></rect>
      <rect y="10" width="18" height="2" fill="currentColor"></rect>
    </svg>
  );
};

const InfoIcon: FunctionComponent = () => {
  return (
    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M13 7C13 10.3137 10.3137 13 7 13C3.68629 13 1 10.3137 1 7C1 3.68629 3.68629 1 7 1C10.3137 1 13 3.68629 13 7ZM14 7C14 10.866 10.866 14 7 14C3.13401 14 0 10.866 0 7C0 3.13401 3.13401 0 7 0C10.866 0 14 3.13401 14 7ZM7.66658 11H6.33325V9.66667H7.66658V11ZM4.33325 5.66667C4.33325 4.19333 5.52659 3 6.99992 3C8.47325 3 9.66658 4.19333 9.66658 5.66667C9.66658 6.52194 9.1399 6.98221 8.62709 7.43036C8.1406 7.85551 7.66658 8.26975 7.66658 9H6.33325C6.33325 7.78582 6.96133 7.30439 7.51355 6.88112C7.94674 6.54907 8.33325 6.25281 8.33325 5.66667C8.33325 4.93333 7.73325 4.33333 6.99992 4.33333C6.26658 4.33333 5.66658 4.93333 5.66658 5.66667H4.33325Z" fill="currentColor"/>
    </svg>
  );
};

export {
  SummaryIcon,
  NavigationIcon,
  TimespanIcon,
  SnapshotIcon,
  CloseIcon,
  EnvIcon,
  NetworkIcon,
  CpuIcon,
  HamburgerIcon,
  InfoIcon,
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent, JSX} from 'preact';
import {useState} from 'preact/hooks';

import {HelpDialog} from './help-dialog';
import {getFlowResultFilenamePrefix} from '../../report/generator/file-namer';
import {useLocalizedStrings} from './i18n/i18n';
import {HamburgerIcon, InfoIcon} from './icons';
import {useFlowResult, useOptions} from './util';
import {saveFile} from '../../report/renderer/api';

function saveHtml(flowResult: LH.FlowResult, htmlStr: string) {
  const blob = new Blob([htmlStr], {type: 'text/html'});
  const filename = getFlowResultFilenamePrefix(flowResult) + '.html';
  saveHtml.saveFile(blob, filename);
}

// Store `saveFile` here so we can do dependency injection.
saveHtml.saveFile = saveFile;

/* eslint-disable max-len */
const Logo: FunctionComponent = () => {
  return (
    <svg role="img" class="lh-topbar__logo" title="Lighthouse logo" width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
      <path d="m14 7 10-7 10 7v10h5v7h-5l5 24H9l5-24H9v-7h5V7Z" fill="#F63"/>
      <path d="M31.561 24H14l-1.689 8.105L31.561 24ZM18.983 48H9l1.022-4.907L35.723 32.27l1.663 7.98L18.983 48Z" fill="#FFA385"/>
      <path fill="#FF3" d="M20.5 10h7v7h-7z"/>
    </svg>
  );
};
/* eslint-enable max-len */

const TopbarButton: FunctionComponent<{
  onClick: JSX.MouseEventHandler<HTMLButtonElement>,
  label: string,
}> =
({onClick, label, children}) => {
  return (
    <button className="TopbarButton" onClick={onClick} aria-label={label}>
      {children}
    </button>
  );
};

const Topbar: FunctionComponent<{onMenuClick: JSX.MouseEventHandler<HTMLButtonElement>}> =
({onMenuClick}) => {
  const flowResult = useFlowResult();
  const strings = useLocalizedStrings();
  const [showHelpDialog, setShowHelpDialog] = useState(false);
  const {getReportHtml, saveAsGist} = useOptions();

  return (
    <div className="Topbar">
      <TopbarButton onClick={onMenuClick} label="Button that opens and closes the sidebar">
        <HamburgerIcon/>
      </TopbarButton>
      <div className="Topbar__logo">
        <Logo/>
      </div>
      <div className="Topbar__title">{strings.title}</div>
      {
        getReportHtml &&
          <TopbarButton
            onClick={() => {
              const htmlStr = getReportHtml(flowResult);
              saveHtml(flowResult, htmlStr);
            }}
            label="Button that saves the report as HTML"
          >{strings.save}</TopbarButton>
      }
      {
        saveAsGist &&
          <TopbarButton
            onClick={() => saveAsGist(flowResult)}
            label="Button that saves the report to a gist"
          >{strings.dropdownSaveGist}</TopbarButton>
      }
      <div style={{flexGrow: 1}} />
      <TopbarButton
        onClick={() => setShowHelpDialog(previous => !previous)}
        label="Button that toggles the help dialog"
      >
        <div className="Topbar__help-label">
          <InfoIcon/>
          {strings.helpLabel}
        </div>
      </TopbarButton>
      {showHelpDialog ?
        <HelpDialog onClose={() => setShowHelpDialog(false)} /> :
        null
      }
    </div>
  );
};

export {
  Topbar,
  saveHtml,
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {createContext, FunctionComponent} from 'preact';
import {useContext, useMemo} from 'preact/hooks';

import {formatMessage} from '../../../shared/localization/format';
import {I18nFormatter} from '../../../report/renderer/i18n-formatter';
import {UIStrings} from './ui-strings';
import {useFlowResult} from '../util';
import strings from './localized-strings.js';
import {UIStrings as ReportUIStrings} from '../../../report/renderer/report-utils.js';
import {Globals} from '../../../report/renderer/report-globals.js';

const I18nContext = createContext({
  formatter: new I18nFormatter('en-US'),
  strings: {...ReportUIStrings, ...UIStrings},
});

function useLhrLocale() {
  const flowResult = useFlowResult();
  const firstLhr = flowResult.steps[0].lhr;
  const locale = firstLhr.configSettings.locale;

  if (flowResult.steps.some(step => step.lhr.configSettings.locale !== locale)) {
    console.warn('LHRs have inconsistent locales');
  }

  return {
    locale,
    lhrStrings: firstLhr.i18n.rendererFormattedStrings,
  };
}

function useI18n() {
  return useContext(I18nContext);
}

function useLocalizedStrings() {
  const i18n = useI18n();
  return i18n.strings;
}

function useStringFormatter() {
  const {locale} = useLhrLocale();
  return (str: string, values?: Record<string, string|number>) => {
    return formatMessage(str, values, locale);
  };
}

const I18nProvider: FunctionComponent = ({children}) => {
  const {locale, lhrStrings} = useLhrLocale();

  const i18n = useMemo(() => {
    Globals.apply({
      providedStrings: {
        // Preload with strings from the first lhr.
        // Used for legacy report components imported into the flow report.
        ...lhrStrings,
        // Set any missing flow strings to default (english) values.
        ...UIStrings,
        // `strings` is generated in build/build-report.js
        ...strings[locale],
      },
      i18n: new I18nFormatter(locale),
      reportJson: null,
    });

    return {
      formatter: Globals.i18n,
      strings: Globals.strings as typeof UIStrings & typeof ReportUIStrings,
    };
  }, [locale, lhrStrings]);

  return (
    <I18nContext.Provider value={i18n}>
      {children}
    </I18nContext.Provider>
  );
};

export {
  useI18n,
  useLocalizedStrings,
  useStringFormatter,
  I18nProvider,
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

import {FlowSegment} from '../common';
import {classNames, useHashState, useFlowResult} from '../util';
import {Separator} from '../common';

const SidebarFlowStep: FunctionComponent<{
  mode: LH.Result.GatherMode,
  href: string,
  label: string,
  isCurrent: boolean,
}> = ({href, label, mode, isCurrent}) => {
  return (
    <a
      className={classNames('SidebarFlowStep', {'Sidebar--current': isCurrent})}
      href={href}
    >
      <div>
        <FlowSegment mode={mode}/>
      </div>
      <div className={`SidebarFlowStep__label SidebarFlowStep__label--${mode}`}>{label}</div>
    </a>
  );
};

const SidebarFlowSeparator: FunctionComponent = () => {
  return (
    <div className="SidebarFlowSeparator">
      <FlowSegment/>
      <Separator/>
      <FlowSegment/>
    </div>
  );
};

export const SidebarFlow: FunctionComponent = () => {
  const flowResult = useFlowResult();
  const hashState = useHashState();

  return (
    <div className="SidebarFlow">
      {
        flowResult.steps.map((step, index) => {
          const {lhr, name} = step;
          return <>
            {
              lhr.gatherMode === 'navigation' && index !== 0 ?
                <SidebarFlowSeparator/> :
                undefined
            }
            <SidebarFlowStep
              key={lhr.fetchTime}
              mode={lhr.gatherMode}
              href={`#index=${index}`}
              label={name}
              isCurrent={index === hashState?.index}
            />
          </>;
        })
      }
    </div>
  );
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

import {ReportUtils} from '../../../report/renderer/report-utils.js';
import {Separator} from '../common';
import {useI18n, useLocalizedStrings} from '../i18n/i18n';
import {CpuIcon, EnvIcon, NetworkIcon, SummaryIcon} from '../icons';
import {classNames, useHashState, useFlowResult} from '../util';
import {SidebarFlow} from './flow';

const SidebarSummary: FunctionComponent = () => {
  const hashState = useHashState();
  const strings = useLocalizedStrings();

  return (
    <a
      href="#"
      className={classNames('SidebarSummary', {'Sidebar--current': hashState === null})}
      data-testid="SidebarSummary"
    >
      <div className="SidebarSummary__icon">
        <SummaryIcon/>
      </div>
      <div className="SidebarSummary__label">{strings.summary}</div>
    </a>
  );
};

const SidebarRuntimeSettings: FunctionComponent<{settings: LH.ConfigSettings}> =
({settings}) => {
  const strings = useLocalizedStrings();
  const env = ReportUtils.getEmulationDescriptions(settings);
  const deviceEmulationString = env.screenEmulation ?
    `${env.deviceEmulation} - ${env.screenEmulation}` :
    env.deviceEmulation;

  return (
    <div className="SidebarRuntimeSettings">
      <div className="SidebarRuntimeSettings__item" title={strings.runtimeSettingsDevice}>
        <div className="SidebarRuntimeSettings__item--icon">
          <EnvIcon/>
        </div>
        {
          deviceEmulationString
        }
      </div>
      <div
        className="SidebarRuntimeSettings__item"
        title={strings.runtimeSettingsNetworkThrottling}
      >
        <div className="SidebarRuntimeSettings__item--icon">
          <NetworkIcon/>
        </div>
        {
          env.summary
        }
      </div>
      <div className="SidebarRuntimeSettings__item" title={strings.runtimeSettingsCPUThrottling}>
        <div className="SidebarRuntimeSettings__item--icon">
          <CpuIcon/>
        </div>
        {
          `${settings.throttling.cpuSlowdownMultiplier}x slowdown`
        }
      </div>
    </div>
  );
};

const SidebarHeader: FunctionComponent<{title: string, date: string}> = ({title, date}) => {
  const i18n = useI18n();
  return (
    <div className="SidebarHeader">
      <div className="SidebarHeader__title">{title}</div>
      <div className="SidebarHeader__date">{i18n.formatter.formatDateTime(date)}</div>
    </div>
  );
};

const Sidebar: FunctionComponent = () => {
  const flowResult = useFlowResult();
  const firstLhr = flowResult.steps[0].lhr;
  return (
    <div className="Sidebar">
      <SidebarHeader title={flowResult.name} date={firstLhr.fetchTime}/>
      <Separator/>
      <SidebarSummary/>
      <Separator/>
      <SidebarFlow/>
      <Separator/>
      <SidebarRuntimeSettings settings={firstLhr.configSettings}/>
    </div>
  );
};

export {
  SidebarSummary,
  SidebarRuntimeSettings,
  SidebarHeader,
  Sidebar,
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

import {ReportUtils} from '../../../report/renderer/report-utils.js';
import {Separator} from '../common';
import {CategoryScore} from '../wrappers/category-score';
import {useI18n, useStringFormatter, useLocalizedStrings} from '../i18n/i18n';
import {Markdown} from '../wrappers/markdown';

import type {UIStringsType} from '../i18n/ui-strings';

const MAX_TOOLTIP_AUDITS = 2;

type ScoredAuditRef = LH.ReportResult.AuditRef & {result: {score: number}};

function getGatherModeLabel(gatherMode: LH.Result.GatherMode, strings: UIStringsType) {
  switch (gatherMode) {
    case 'navigation': return strings.navigationReport;
    case 'timespan': return strings.timespanReport;
    case 'snapshot': return strings.snapshotReport;
  }
}

function getCategoryRating(rating: string, strings: UIStringsType) {
  switch (rating) {
    case 'pass': return strings.ratingPass;
    case 'average': return strings.ratingAverage;
    case 'fail': return strings.ratingFail;
    case 'error': return strings.ratingError;
  }
}

function getScoreToBeGained(audit: ScoredAuditRef): number {
  return audit.weight * (1 - audit.result.score);
}

const SummaryTooltipAudit: FunctionComponent<{audit: LH.ReportResult.AuditRef}> = ({audit}) => {
  const rating = ReportUtils.calculateRating(audit.result.score, audit.result.scoreDisplayMode);
  return (
    <div className={`SummaryTooltipAudit SummaryTooltipAudit--${rating}`}>
      <Markdown text={audit.result.title}/>
    </div>
  );
};

const SummaryTooltipAudits: FunctionComponent<{category: LH.ReportResult.Category}> =
({category}) => {
  const strings = useLocalizedStrings();

  function isRelevantAudit(audit: LH.ReportResult.AuditRef): audit is ScoredAuditRef {
    return audit.result.score !== null &&
      // Metrics should not be displayed in this group.
      audit.group !== 'metrics' &&
      // Audits in group "hidden" should not be counted.
      audit.group !== 'hidden' &&
      // We don't want unweighted audits except for performance diagnostics.
      (audit.weight > 0 || audit.group === 'diagnostics') &&
      // Passing audits should never be high impact.
      !ReportUtils.showAsPassed(audit.result);
  }

  const audits = category.auditRefs
    .filter(isRelevantAudit)
    .sort((a, b) => {
      // Remaining score should always be 0 for perf opportunities because weight is 0.
      // In that case, we want to sort by `overallSavingsMs`.
      const remainingScoreA = getScoreToBeGained(a);
      const remainingScoreB = getScoreToBeGained(b);
      if (remainingScoreA !== remainingScoreB) return remainingScoreB - remainingScoreA;
      if (a.result.score !== b.result.score) return a.result.score - b.result.score;

      // TODO: Sort using overall impact from metric savings, not just LCP
      const aLcpSavings = a.result.metricSavings?.LCP || 0;
      const bLcpSavings = b.result.metricSavings?.LCP || 0;
      return bLcpSavings - aLcpSavings;
    })
    .splice(0, MAX_TOOLTIP_AUDITS);
  if (!audits.length) return null;

  return (
    <div className="SummaryTooltipAudits">
      <div className="SummaryTooltipAudits__title">{strings.highestImpact}</div>
      {
        audits.map(audit => <SummaryTooltipAudit key={audit.id} audit={audit}/>)
      }
    </div>
  );
};

const SummaryTooltip: FunctionComponent<{
  category: LH.ReportResult.Category,
  gatherMode: LH.Result.GatherMode,
  url: string,
}> = ({category, gatherMode, url}) => {
  const strings = useLocalizedStrings();
  const str_ = useStringFormatter();
  const {
    numPassed,
    numPassableAudits,
    numInformative,
    totalWeight,
  } = ReportUtils.calculateCategoryFraction(category);

  const i18n = useI18n();
  const displayAsFraction = ReportUtils.shouldDisplayAsFraction(gatherMode);
  const score = displayAsFraction ?
    numPassed / numPassableAudits :
    category.score;
  const rating = score === null ? 'error' : ReportUtils.calculateRating(score);

  return (
    <div className="SummaryTooltip">
      <div className="SummaryTooltip__title">{getGatherModeLabel(gatherMode, strings)}</div>
      <div className="SummaryTooltip__url">{url}</div>
      <Separator/>
      <div className="SummaryTooltip__category">
        <div className="SummaryTooltip__category-title">
          {category.title}
        </div>
        {
          totalWeight !== 0 &&
            <div className={`SummaryTooltip__rating SummaryTooltip__rating--${rating}`}>
              <span>{getCategoryRating(rating, strings)}</span>
              {
                !displayAsFraction && category.score !== null && <>
                  <span> · </span>
                  <span>{i18n.formatter.formatInteger(category.score * 100)}</span>
                </>
              }
            </div>
        }
      </div>
      <div className="SummaryTooltip__fraction">
        <span>{str_(strings.passedAuditCount, {numPassed})}</span>
        <span> / </span>
        <span>{str_(strings.passableAuditCount, {numPassableAudits})}</span>
      </div>
      {numInformative !== 0 &&
        <div className="SummaryTooltip__informative">
          {str_(strings.informativeAuditCount, {numInformative})}
        </div>
      }
      <SummaryTooltipAudits category={category}/>
    </div>
  );
};

const SummaryCategory: FunctionComponent<{
  category: LH.ReportResult.Category|undefined,
  href: string,
  gatherMode: LH.Result.GatherMode,
  finalDisplayedUrl: string,
}> = ({category, href, gatherMode, finalDisplayedUrl}) => {
  return (
    <div className="SummaryCategory">
      {
        category ?
          <div className="SummaryCategory__content">
            <CategoryScore
              category={category}
              href={href}
              gatherMode={gatherMode}
            />
            <SummaryTooltip category={category} gatherMode={gatherMode} url={finalDisplayedUrl}/>
          </div> :
          <div className="SummaryCategory__null" data-testid="SummaryCategory__null"/>
      }
    </div>
  );
};

export {
  SummaryTooltip,
  SummaryCategory,
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';
import {useMemo} from 'preact/hooks';

import {FlowSegment, FlowStepThumbnail, Separator} from '../common';
import {getModeDescription, useFlowResult} from '../util';
import {ReportUtils} from '../../../report/renderer/report-utils.js';
import {SummaryCategory} from './category';
import {useStringFormatter, useLocalizedStrings} from '../i18n/i18n';

const DISPLAYED_CATEGORIES = ['performance', 'accessibility', 'best-practices', 'seo'];
const THUMBNAIL_WIDTH = 40;

const SummaryNavigationHeader: FunctionComponent<{lhr: LH.Result}> = ({lhr}) => {
  const strings = useLocalizedStrings();

  return (
    <div className="SummaryNavigationHeader" data-testid="SummaryNavigationHeader">
      <FlowSegment/>
      <div className="SummaryNavigationHeader__url">
        <a rel="noopener" target="_blank" href={lhr.finalDisplayedUrl}>{lhr.finalDisplayedUrl}</a>
      </div>
      <div className="SummaryNavigationHeader__category">
        {strings.categoryPerformance}
      </div>
      <div className="SummaryNavigationHeader__category">
        {strings.categoryAccessibility}
      </div>
      <div className="SummaryNavigationHeader__category">
        {strings.categoryBestPractices}
      </div>
      <div className="SummaryNavigationHeader__category">
        {strings.categorySeo}
      </div>
    </div>
  );
};

/**
 * The div should behave like a JSX <>...</>. This still allows us to identify "rows" with CSS selectors.
 */
const SummaryFlowStep: FunctionComponent<{
  lhr: LH.Result,
  label: string,
  hashIndex: number,
}> = ({lhr, label, hashIndex}) => {
  const reportResult = useMemo(() => ReportUtils.prepareReportResult(lhr), [lhr]);
  const strings = useLocalizedStrings();
  const modeDescription = getModeDescription(lhr.gatherMode, strings);

  return (
    <div className="SummaryFlowStep">
      {
        lhr.gatherMode === 'navigation' || hashIndex === 0 ?
          <SummaryNavigationHeader lhr={lhr}/> :
          <div className="SummaryFlowStep__separator">
            <FlowSegment/>
            <Separator/>
          </div>
      }
      <FlowStepThumbnail lhr={lhr} width={THUMBNAIL_WIDTH}/>
      <FlowSegment mode={lhr.gatherMode}/>
      <div className="SummaryFlowStep__label">
        <div className="SummaryFlowStep__mode">{modeDescription}</div>
        <a className="SummaryFlowStep__link" href={`#index=${hashIndex}`}>{label}</a>
      </div>
      {
        DISPLAYED_CATEGORIES.map(c => (
          <SummaryCategory
            key={c}
            category={reportResult.categories[c]}
            href={`#index=${hashIndex}&anchor=${c}`}
            gatherMode={lhr.gatherMode}
            finalDisplayedUrl={lhr.finalDisplayedUrl}
          />
        ))
      }
    </div>
  );
};

/**
 * For the summary flow, there are many different cells with different contents and different display properties.
 * CSS grid makes it easier to enforce things like content alignment and column width (e.g. all category columns have the same width).
 */
const SummaryFlow: FunctionComponent = () => {
  const flowResult = useFlowResult();
  return (
    <div className="SummaryFlow">
      {
        flowResult.steps.map((step, index) =>
          <SummaryFlowStep
            key={step.lhr.fetchTime}
            lhr={step.lhr}
            label={step.name}
            hashIndex={index}
          />
        )
      }
    </div>
  );
};

const SummaryHeader: FunctionComponent = () => {
  const flowResult = useFlowResult();
  const strings = useLocalizedStrings();
  const str_ = useStringFormatter();

  let numNavigation = 0;
  let numTimespan = 0;
  let numSnapshot = 0;
  for (const step of flowResult.steps) {
    switch (step.lhr.gatherMode) {
      case 'navigation':
        numNavigation++;
        break;
      case 'timespan':
        numTimespan++;
        break;
      case 'snapshot':
        numSnapshot++;
        break;
    }
  }

  const subtitleCounts = [];
  if (numNavigation) subtitleCounts.push(str_(strings.navigationReportCount, {numNavigation}));
  if (numTimespan) subtitleCounts.push(str_(strings.timespanReportCount, {numTimespan}));
  if (numSnapshot) subtitleCounts.push(str_(strings.snapshotReportCount, {numSnapshot}));
  const subtitle = subtitleCounts.join(' · ');

  return (
    <div className="SummaryHeader">
      <div className="SummaryHeader__title">{strings.summary}</div>
      <div className="SummaryHeader__subtitle">{subtitle}</div>
    </div>
  );
};

const SummarySectionHeader: FunctionComponent = ({children}) => {
  return (
    <div className="SummarySectionHeader">
      <div className="SummarySectionHeader__content">{children}</div>
      <Separator/>
    </div>
  );
};

const Summary: FunctionComponent = () => {
  const strings = useLocalizedStrings();

  return (
    <div className="Summary" data-testid="Summary">
      <SummaryHeader/>
      <Separator/>
      <SummarySectionHeader>{strings.allReports}</SummarySectionHeader>
      <SummaryFlow/>
    </div>
  );
};

export {
  SummaryFlowStep,
  SummaryHeader,
  Summary,
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

import {renderCategoryScore} from '../../../report/renderer/api';
import {useExternalRenderer} from '../util';

export const CategoryScore: FunctionComponent<{
  category: LH.ReportResult.Category,
  href: string,
  gatherMode: LH.Result.GatherMode,
}> = ({category, href, gatherMode}) => {
  const ref = useExternalRenderer<HTMLDivElement>(() => {
    return renderCategoryScore(category, {
      gatherMode,
      omitLabel: true,
      onPageAnchorRendered: link => link.href = href,
    });
  }, [category, href]);

  return (
    <div ref={ref} data-testid="CategoryScore"/>
  );
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

import {convertMarkdownCodeSnippets} from '../../../report/renderer/api';
import {useExternalRenderer} from '../util';

export const Markdown: FunctionComponent<{text: string}> = ({text}) => {
  const ref = useExternalRenderer<HTMLSpanElement>(() => {
    return convertMarkdownCodeSnippets(text);
  }, [text]);

  return <span ref={ref}/>;
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

import {renderReport} from '../../../report/renderer/api.js';
import {useExternalRenderer} from '../util';

/**
 * The default behavior of anchor links is not compatible with the flow report's hash navigation.
 * This function converts a category score anchor link to a flow report link.
 * e.g. <a href="#link"> -> <a href="#index=0&anchor=link">
 */
function convertAnchor(link: HTMLAnchorElement, index: number) {
  // Clear existing event listeners by cloning node.
  const newLink = link.cloneNode(true) as HTMLAnchorElement;
  if (!newLink.hash) return newLink;

  const nodeId = link.hash.substr(1);
  newLink.hash = `#index=${index}&anchor=${nodeId}`;
  newLink.onclick = e => {
    e.preventDefault();
    const el = document.getElementById(nodeId);
    if (el) el.scrollIntoView();
  };
  link.replaceWith(newLink);
}

export const Report: FunctionComponent<{hashState: LH.HashState}> =
({hashState}) => {
  const ref = useExternalRenderer<HTMLDivElement>(() => {
    return renderReport(hashState.currentLhr, {
      disableFireworks: true,
      disableDarkMode: true,
      omitTopbar: true,
      omitGlobalStyles: true,
      onPageAnchorRendered: link => convertAnchor(link, hashState.index),
    });
  }, [hashState]);

  return (
    <div ref={ref} data-testid="Report"/>
  );
};
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import {FunctionComponent} from 'preact';

import {createStylesElement} from '../../../report/renderer/api';
import {useExternalRenderer} from '../util';

export const Styles: FunctionComponent = () => {
  const ref = useExternalRenderer<HTMLDivElement>(createStylesElement);

  return <div ref={ref}/>;
};
// src/app/layout.tsx
import { Inter } from 'next/font/google'
import './globals.css'
import { ReactNode } from 'react'
import { GoogleAnalytics } from '@next/third-parties/google';

const inter = Inter({ subsets: ['latin'] })

export const metadata = {
  metadataBase: new URL('https://aqua-service-karelia.ru/'),
  title: {
    default: 'АкваСервис - Бурение скважин, водоочистка, насосы и фильтры в Петрозаводске | Консультации, монтаж и сервис',
    template: '%s | АкваСервис Карелия'
  },
  description: 'Профессиональное бурение скважин, установка систем водоочистки и автономной канализации в Петрозаводске и Республике Карелия. 15+ лет опыта, гарантия 10 лет, оборудование от производителя. Работаем в Петрозаводске, Кондопоге, Медвежьегорске, Пряже, Шуе, Сортавале.',
  openGraph: {
    images: '/images/og-image.png',
    locale: 'ru_RU',
    type: 'website',
  },
  keywords: [
    'бурение скважин Петрозаводск',
    'водоочистка Карелия',
    'автономная канализация',
    'ремонт скважин',
    'химический анализ воды'
  ],
  icons: {
    icon: '/images/favicon.ico',
    shortcut: '/images/favicon.ico',
    apple: '/images/apple-touch-icon.png',
  },
}


interface LayoutProps {
  children: ReactNode
}

export default function RootLayout({ children }: LayoutProps) {
  return (
    <html
      lang="ru"
      suppressHydrationWarning
      className={`${inter.className} antialiased`}
    >
      <body className="bg-white">
        {children}
        <GoogleAnalytics gaId="G-0YHV1T38RB" />

      </body>
    </html>
  )
}

'use client';
import { Suspense } from 'react';
import dynamic from 'next/dynamic';
import Header from "./components/Header";
import ServicesSlider from "./components/ServicesSlider";
import EquipmentSlider from './components/EquipmentSlider';
import Advantages from './components/Advantages';
import WorkSteps from './components/WorkSteps';
import PriceForm from './components/PriceForm';
import PriceCalculator from './components/PriceCalculator';
import Footer from './components/Footer';
import FullscreenSlider from './components/FullscreenSlider';
import { LocalBusinessSchema } from "./components/LocalBusinessSchema";

// Динамический импорт MapSection с отключённым SSR
const MapSection = dynamic(() => import('./components/MapSection').then(mod => mod.default), { ssr: false });

// Динамический импорт BlogPreview как серверного компонента
const BlogPreview = dynamic(() => import('./components/BlogPreview'), { ssr: true });

export default function Home() {
  const scrollToForm = () => {
    const element = document.getElementById('price-form-section');
    if (element) {
      const yOffset = -80;
      const y = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
      window.scrollTo({ top: y, behavior: 'smooth' });
    }
  };

  return (
    <main>
      <LocalBusinessSchema />
      <Header />
      <FullscreenSlider scrollToForm={scrollToForm} />
      <MapSection />
      <PriceForm />
      <ServicesSlider />
      <EquipmentSlider />
      <Advantages />
      <WorkSteps />
      <PriceCalculator />
      <Suspense fallback={<div>Загрузка превью блога...</div>}>
      <BlogPreview />
      </Suspense>
      <Footer />
    </main>
  );
}
// app/about/page.tsx
import Header from "../components/Header";
import Footer from "../components/Footer";
import Advantages from "../components/Advantages";
import MapSection from "../components/MapSection";
import WorkSteps from "../components/WorkSteps";
import EquipmentSlider from "../components/EquipmentSlider";
import Image from "next/image";

export default async function AboutPage() {
  return (
    <main className="flex flex-col min-h-screen">
      <Header />

      {/* Герой-секция */}
      <section className="container mx-auto px-4 py-12">
        <div className="text-center max-w-3xl mx-auto">
          <h1 className="text-3xl md:text-4xl font-bold text-[#218CE9] mb-6">
            О компании АкваСервис
          </h1>
          <p className="text-lg text-gray-600 mb-8">
            Более 15 лет мы дарим людям чистую воду. От небольшой бригады
            до лидера рынка - наш путь основан на профессионализме и
            ответственности перед каждым клиентом.
          </p>
        </div>

        {/* Блок истории */}
        <div className="grid md:grid-cols-2 gap-8 items-center bg-[#F5F5F5] rounded-2xl p-8 mb-12">
          <div className="space-y-4">
            <h2 className="text-2xl font-bold text-[#218CE9]">Наша история</h2>
            <p className="text-gray-600">
              Начав с бурения первых скважин в Подмосковье в 2010 году,
              мы выросли в компанию с филиалами в 12 регионах России.
            </p>
            <ul className="list-disc pl-5 space-y-2 text-gray-600">
              <li>2010 - Основание компании</li>
              <li>2014 - Сертификация ISO 9001</li>
              <li>2018 - Запуск собственного производства оборудования</li>
              <li>2023 - 1200+ успешных проектов</li>
            </ul>
          </div>
          <Image
            src="/images/about-history.jpg"
            alt="История компании"
            width={800}
            height={500}
            className="rounded-xl shadow-lg"
            priority
          />
        </div>
      </section>

      {/* Ценности компании */}
      <section className="bg-white py-12">
        <div className="container mx-auto px-4">
          <Advantages />
        </div>
      </section>

      {/* География работы */}
      <section className="py-12">
        <div className="container mx-auto px-4">
          <h2 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-8">
            Мы работаем в 12 регионах
          </h2>
          <MapSection />
        </div>
      </section>

      {/* Процесс контроля качества */}
      <section className="bg-[#F5F5F5] py-12">
        <div className="container mx-auto px-4">
          <h2 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-8">
            Контроль качества на всех этапах
          </h2>
          <WorkSteps />


        </div>
      </section>

      {/* Наше оборудование */}
      <section className="py-12">
        <div className="container mx-auto px-4">
          <h2 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-8">
            Технологии и инновации
          </h2>
          <EquipmentSlider />
        </div>
      </section>

      <Footer />
    </main>
  );
}// app/blog/page.tsx
import { supabase } from '@/lib/supabase';
import Link from 'next/link';
import Header from '../components/Header';
import Image from 'next/image';

export default async function BlogPage() {
    const { data: categories } = await supabase
        .from('blog_categories')
        .select('id, slug, title, description, image_url'); // Явно выбираем нужные поля

    return (
        <main>
            <Header />

            <section className="container mx-auto px-4 py-8">
                <h1 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-8">
                    Блог о воде и скважинах
                </h1>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {categories?.map((category) => (
                        <Link
                            key={category.id}
                            href={`/blog/${category.slug}`}
                            className="group bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow overflow-hidden"
                        >
                            <div className="relative h-48 w-full">
                                {category.image_url ? (
                                    <Image
                                        src={category.image_url}
                                        alt={category.title} // Используем русское название для alt
                                        fill
                                        className="object-cover transition-transform duration-500 group-hover:scale-105"
                                        sizes="(max-width: 768px) 100vw, 33vw"
                                    />
                                ) : (
                                    <div className="w-full h-full bg-gray-100 flex items-center justify-center">
                                        <span className="text-gray-400">Нет изображения</span>
                                    </div>
                                )}
                                <div className="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent" />
                            </div>

                            <div className="p-6">
                                <h2 className="text-xl font-bold text-[#218CE9] mb-2">
                                    {category.title}
                                </h2>
                                {category.description && (
                                    <p className="text-gray-600 line-clamp-3">
                                        {category.description}
                                    </p>
                                )}
                            </div>
                        </Link>
                    ))}
                </div>

                {!categories?.length && (
                    <div className="text-center text-red-500 py-8">
                        Категории временно недоступны
                    </div>
                )}
            </section>
        </main>
    );
}// src/app/blog/[category]/page.tsx
import { supabase } from '@/lib/supabase';
import Link from 'next/link';
import Header from '../../components/Header';
import Image from 'next/image';

// Define the structure of a post
interface Post {
    id: number;
    slug: string;
    title: string;
    excerpt: string;
    created_at: string;
    image_url?: string;
    blog_categories: {
        slug: string;
        title: string;
        image_url?: string;
    }[];
}

export async function generateStaticParams() {
    const { data: categories, error } = await supabase
        .from('blog_categories')
        .select('slug');

    if (error) {
        console.error('Ошибка получения категорий:', error);
        return [];
    }

    return categories.map((cat: { slug: string }) => ({ category: cat.slug }));
}

export default async function CategoryBlogPage({
    params
}: {
    params: Promise<{category: string }>
}) {
    const {category} = await params; 
    const { data: posts, error } = await supabase
        .from('blog_posts')
        .select(`
            *,
            blog_categories:blog_categories!inner(slug, title, image_url)
        `)
        .eq('blog_categories.slug', category)
        .order('created_at', { ascending: false });

    if (error || !posts) {
        return (
            <main>
                <Header />
                <div className="container mx-auto px-4 py-8 text-center text-red-500">
                    Ошибка загрузки постов
                </div>
            </main>
        );
    }
    console.log('Posts data:', JSON.stringify(posts, null, 2));

    const firstPostCategory = posts[0]?.blog_categories?.[0];

    return (
        <main>
            <Header />

            <section className="container mx-auto px-4 py-8">
                {/* Шапка категории */}
                <div className="mb-8">
                    <div className="relative h-64 w-full rounded-xl overflow-hidden shadow-lg bg-gray-100">
                        {firstPostCategory?.image_url && (
                            <Image
                                src={firstPostCategory.image_url}
                                alt={firstPostCategory.title || category}
                                fill
                                className="object-cover"
                                sizes="(max-width: 768px) 100vw, 80vw"
                                priority
                            />
                        )}
                        <div className="absolute inset-0 bg-gradient-to-t from-[#218CE9]/80 to-transparent" />
                        <div className="absolute bottom-4 left-4 right-4">
                            <h1 className="text-3xl md:text-4xl font-bold text-white">
                                {posts[0]?.blog_categories?.title || category}
                            </h1>
                        </div>
                    </div>
                </div>

                {/* Список постов */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {posts.map((post: Post) => (
                        <article
                            key={post.id}
                            className="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow"
                        >
                            <Link href={`/blog/${category}/${post.slug}`}>
                                <div className="relative h-48 w-full">
                                    {post.image_url ? (
                                        <Image
                                            src={post.image_url}
                                            alt={post.title}
                                            fill
                                            className="object-cover rounded-t-xl"
                                            sizes="(max-width: 768px) 100vw, 33vw"
                                        />
                                    ) : (
                                        <div className="w-full h-full bg-gray-100 flex items-center justify-center">
                                            <span className="text-gray-400">Нет изображения</span>
                                        </div>
                                    )}
                                </div>

                                <div className="p-6">
                                    <h2 className="text-xl font-bold text-[#218CE9] mb-2">
                                        {post.title}
                                    </h2>
                                    <p className="text-gray-600 text-sm mb-3 line-clamp-3">
                                        {post.excerpt}
                                    </p>
                                    <time className="text-sm text-gray-400">
                                        {new Date(post.created_at).toLocaleDateString('ru-RU', {
                                            year: 'numeric',
                                            month: 'long',
                                            day: 'numeric'
                                        })}
                                    </time>
                                </div>
                            </Link>
                        </article>
                    ))}
                </div>

                {posts.length === 0 && (
                    <div className="text-center text-red-500 py-8">
                        Постов в этой категории пока нет
                    </div>
                )}
            </section>
        </main>
    );
}
// src/app/blog/[category]/[post]/page.tsx
import { supabase } from '@/lib/supabase';
import Link from 'next/link';
import Script from 'next/script';
import Header from '../../../components/Header';
import Image from 'next/image';
import Head from 'next/head';

export async function generateStaticParams() {
    const { data: posts, error } = await supabase
        .from('blog_posts')
        .select('slug, blog_categories!inner(slug, title)')
        .eq('published', true);

    if (error) return [];

    return posts.map((post) => ({
        category: post.blog_categories[0]?.slug || '',
        post: post.slug
    })).filter(p => p.category);
}

// Обновляем интерфейс PageParams
interface PageParams {
    params: Promise<{
        category: string;
        post: string;
    }>;
}

// Используем явное указание типа для пропсов
export default async function PostPage({ params }: PageParams) {
    const { category, post } = await params;
    const { data: blogPost, error } = await supabase
        .from('blog_posts')
        .select('*, blog_categories!inner(*)')
        .eq('slug', post)
        .single();

    if (error || !blogPost) {
        return (
            <main>
                <Header />
                <div className="container mx-auto px-4 py-8 text-center text-red-500">
                    Пост не найден.
                </div>
            </main>
        );
    }

    const jsonLd = {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": blogPost.title,
        "description": blogPost.excerpt,
        "datePublished": blogPost.created_at,
        "author": {
            "@type": "Organization",
            "name": "АкваСервис",
        },
        "image": blogPost.image_url
    };
    console.log('Posts data:', JSON.stringify(blogPost, null, 2));

    return (
        <main>
            <Header />
            <Head>
                {/* Основные метатеги */}
                <title>{`${blogPost.title} | АкваСервис`}</title>
                <meta name="description" content={blogPost.excerpt} />

                {/* Open Graph (обязательно для ВКонтакте и Telegram) */}
                <meta property="og:title" content={blogPost.title} />
                <meta property="og:description" content={blogPost.excerpt} />
                <meta property="og:type" content="article" />
                <meta
                    property="og:url"
                    content={`https://aqua-service-karelia.ru/blog/${category}/${post}`}
                />
                {blogPost.image_url && (
                    <meta
                        property="og:image"
                        content={`https://aqua-service-karelia.ru/${blogPost.image_url}`}
                    />
                )}

                {/* Дополнительные теги для ВКонтакте */}
                <meta property="vk:image" content={`https://aqua-service-karelia.ru/${blogPost.image_url}`} />
                <meta name="vk:title" content={blogPost.title} />
                <meta name="vk:description" content={blogPost.excerpt} />

                {/* Для Telegram (использует Open Graph, но можно добавить явно) */}
                <meta property="telegram:title" content={blogPost.title} />
                <meta property="telegram:description" content={blogPost.excerpt} />
                {blogPost.image_url && (
                    <meta
                        property="telegram:image"
                        content={`https://aqua-service-karelia.ru/${blogPost.image_url}`}
                    />
                )}

                {/* Каноническая ссылка */}
                <link
                    rel="canonical"
                    href={`https://aqua-service-karelia.ru/blog/${category}/${post}`}
                />
            </Head>

            <Script
                id="post-structured-data"
                type="application/ld+json"
                dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
            />

            <section className="container mx-auto px-4 py-8 max-w-4xl">
                {/* Хлебные крошки */}
                <nav className="mb-8 text-sm text-gray-500" aria-label="Навигация">
                    <ol className="flex flex-wrap items-center space-x-2">
                        <li>
                            <Link
                                href="/"
                                className="hover:text-[#218CE9] transition-colors"
                            >
                                Главная
                            </Link>
                        </li>
                        <li>/</li>
                        <li>
                            <Link
                                href="/blog"
                                className="hover:text-[#218CE9] transition-colors"
                            >
                                Блог
                            </Link>
                        </li>
                        <li>/</li>
                        <li>
                            <Link
                                href={`/blog/${category}`}
                                className="hover:text-[#218CE9] transition-colors"
                            >
                                {blogPost.blog_categories.title || category}
                            </Link>
                        </li>
                        <li>/</li>
                        <li className="text-gray-400 truncate max-w-[200px]">
                            {blogPost.title}
                        </li>
                    </ol>
                </nav>
                {/* Заголовок и метаданные */}
                <div className="mb-8">
                    <h1 className="text-3xl md:text-4xl font-bold text-[#218CE9] mb-4">
                        {blogPost.title}
                    </h1>
                    <div className="flex items-center space-x-4 text-gray-500">
                        <time className="text-sm">
                            {new Date(blogPost.created_at).toLocaleDateString('ru-RU', {
                                day: 'numeric',
                                month: 'long',
                                year: 'numeric'
                            })}
                        </time>
                    </div>
                </div>

                {/* Изображение поста */}
                {blogPost.image_url && (
                    <div className="relative h-64 md:h-96 w-full mb-8">
                        <Image
                            src={blogPost.image_url}
                            alt={`Иллюстрация: ${blogPost.title}`} // Описательный alt
                            fill
                            className="object-cover rounded-xl"
                            sizes="(max-width: 768px) 100vw, 80vw"
                            priority={true} // Приоритетная загрузка для первого изображения
                        />
                    </div>
                )}

                {/* Контент */}
                <article className="prose max-w-none">
                    <div
                        className="text-gray-600 text-lg leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: blogPost.content }}
                    />
                </article>

                {/* Кнопка возврата */}
                <div className="mt-12">
                    <Link
                        href={`/blog/${category}`}
                        className="inline-flex items-center text-[#218CE9] hover:text-[#1a6fb9] transition-colors"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            className="h-5 w-5 mr-2"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                        >
                            <path
                                fillRule="evenodd"
                                d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
                                clipRule="evenodd"
                            />
                        </svg>
                        Назад к категории
                    </Link>
                </div>
            </section>
        </main>
    );
}
// src/app/components/Advantages.tsx
'use client'
import React from 'react'
import Image from 'next/image'; // Добавить в начале файла

const Advantages = () => {
    const advantages = [
        {
            title: 'Комплексное водоснабжение',
            subtitle: 'Полное обеспечение систем водоснабжения',
            image: '/images/advantage5.png',
            content: (
                <>
                    <p className="mb-2 text-left">
                      Мы выполняем полный комплекс работ по водоснабжению загородного дома.
                    </p>
                    <ul className="list-disc pl-5 space-y-2 text-left">
                        <li>Бурение скважин на воду.</li>
                        <li>Обустройство скважины, монтаж водоприемного узла.</li>
                        <li>Установка системы очистки воды.</li>
                    </ul>
                </>
            )
        },
        {
            title: 'Гарантия',
            subtitle: '«Полная ответственность за каждый метр в Карелии»',
            image: '/images/advantage1.png',
            content: (
                <>
                    <p className="mb-2 text-left">
                      Мы уверены в качестве работ и материалов в Петрозаводске и Республике Карелия, поэтому даем максимальную гарантию на бурение и обустройство скважин.
                    </p>
                    <ul className="list-disc pl-5 space-y-2 text-left">
                        <li>Бесплатное устранение любых дефектов, связанных с нашей работой.</li>
                        <li>Гарантия распространяется на герметичность, дебет воды и оборудование.</li>
                        <li>Мы уверены в качестве работ и материалов, поэтому даем максимальную гарантию на бурение и обустройство скважин.</li>
                    </ul>
                </>
            )
        },
        {
            title: 'Собственная техника',
            subtitle: '«Контроль сроков и качества»',
            image: '/images/advantage2.png',
            content: (
                <>
                    <p className="mb-2 text-left">
                      2 единицы современной техники в нашем парке — никаких задержек из-за подрядчиков!
                    </p>
                    <ul className="list-disc pl-5 space-y-2 text-left">
                        <li>Буровые установки УРБ 2А2, малогабаритные установки для сложных участков.</li>
                        <li>Транспорт для логистики (КАМАЗ-вездеходы, манипуляторы).</li>
                        <li>Регулярный техосмотр и обслуживание — снижаем риски поломок.</li>
                    </ul>
                </>
            )
        },
        {
            title: 'Экологичный подход',
            subtitle: '«Бережем ваш участок и природу»',
            image: '/images/advantage3.png',
            content: (
                <>
                    <p className="mb-2 text-left">
                      Используем технологии, которые минимизируют воздействие на окружающую среду:
                    </p>
                    <ul className="list-disc pl-5 space-y-2 text-left">
                        <li>Утилизируем буровой шлам и техническую воду.</li>
                        <li>Не применяем токсичные реагенты.</li>
                        <li>После работ убираем территорию: никаких следов от техники!</li>
                    </ul>
                </>
            )
        },
        {
            title: 'Гарантированные сроки',
            subtitle: '«Четко по графику — или компенсируем простой»',
            image: '/images/advantage4.png',
            content: (
                <>
                    <p className="mb-2 text-left">
                      Даже в сложных условиях (плотный грунт, плохая погода) соблюдаем договоренности:
                    </p>
                    <ul className="list-disc pl-5 space-y-2 text-left">
                        <li>Фиксируем сроки в договоре.</li>
                        <li>При задержке по нашей вине — компенсация 1% от суммы за каждый день.</li>
                        <li>Ежедневные отчеты о прогрессе работ.</li>
                    </ul>
                </>
            )
        },
        {
            title: 'Специальные предложения',
            subtitle: 'Льготное обслуживание для пенсионеров и участников СВО',
            image: '/images/advantage6.png',
            content: (
                <>
                    <p className="mb-2 text-left">
                      Мы предоставляем скидки для пенсионеров и участников СВО, стремясь сделать наши услуги более доступными и поддержать социально значимые группы.
                    </p>
                    <ul className="list-disc pl-5 space-y-2 text-left">
                        <li>Скидки на все виды работ.</li>
                        <li>Индивидуальный подход к каждому клиенту.</li>
                    </ul>
                </>
            )
        },
    ]

    return (
        <section className="container mx-auto px-4 py-4">
            <div className="border-b border-black border-opacity-10 mb-4"></div>

            <h2 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-8 md:mb-12">
                НАШИ ПРЕИМУЩЕСТВА
            </h2>

            <div className="grid grid-cols-2 gap-4 min-[480px]:gap-6 md:gap-8">
                {advantages.map((item, index) => (
                    <article
                        key={index}
                        aria-labelledby={`advantage-${index}`}
                        className="group bg-[#F5F5F5] rounded-xl p-4 md:p-6 shadow-lg"
                    >
                        {/* Кружок с изображением */}
                        <div className="w-20 h-20 md:w-32 md:h-32 mx-auto mb-4 md:mb-6 rounded-full overflow-hidden border-4 border-white shadow-lg">
                            <Image
                                src={item.image}
                                alt={item.title}
                                width={128}
                                height={128}
                                className="w-full h-full object-cover"
                            />
                        </div>

                        {/* Основной контент */}
                        <div className="text-center">
                            <h3
                                id={`advantage-${index}`}
                                className="text-base md:text-xl lg:text-2xl font-bold text-[#218CE9] mb-1 md:mb-2"
                            >
                                {item.title}
                            </h3>
                            <p className="text-xs md:text-sm text-[#666] italic mb-2 md:mb-4">
                                {item.subtitle}
                            </p>

                            {/* Дополнительный контент */}
                            <div className="max-h-0 overflow-hidden transition-all duration-500 group-hover:max-h-[500px]">
                                <div className="pt-2 md:pt-4 border-t border-[#218CE9]/20">
                                    <div className="text-xs md:text-sm">
                                        {item.content}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </article>
                ))}
            </div>
        </section>
    )
}

export default Advantages
// app/components/ApplicationForm.tsx
"use client";
import { useState } from "react";

export default function ApplicationForm() {
  const [formData, setFormData] = useState({
    fullName: "",
    phone: "",
    email: "",
    address: "",
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      const response = await fetch("http://localhost:1337/api/applications", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: formData }),
      });
      if (response.ok) alert("Заявка отправлена!");
    } catch (error) {
      console.error("Ошибка:", error);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <input
        type="text"
        placeholder="ФИО"
        required
        onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}
      />
      <input
        type="tel"
        placeholder="Телефон"
        required
        onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
      />
      <input
        type="email"
        placeholder="Email"
        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
      />
      <textarea
        placeholder="Адрес"
        required
        onChange={(e) => setFormData({ ...formData, address: e.target.value })}
      />
      <button type="submit" className="bg-blue-600 text-white p-2 rounded">
        Отправить
      </button>
    </form>
  );
}// app/components/BlogPreview.tsx
'use client'
import { useEffect, useState } from 'react';
import { supabase } from '@/lib/supabase';
import Link from 'next/link';
import Image from 'next/image';

interface Category {
    id: number;
    slug: string;
    title: string;
    description?: string;
    image_url?: string;
}

export default function BlogPreview() {
    const [categories, setCategories] = useState<Category[] | null>(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        async function fetchCategories() {
            const { data } = await supabase
                .from('blog_categories')
                .select('id, slug, title, description, image_url')
                .limit(3);
            setCategories(data);
            setLoading(false);
        }
        fetchCategories();
    }, []);

    if (loading) {
        return <div>Загрузка превью блога...</div>;
    }

    return (
        <div className="container mx-auto px-4 py-12 ">
            <section className='bg-[#F5F5F5] rounded-xl mx-auto px-4 py-8'>
                <div className="text-center mb-8">
                    <h2 className="text-3xl md:text-4xl font-bold text-[#218CE9]">
                        Полезные статьи о бурении и воде
                    </h2>
                </div>
                {categories && categories.length > 0 ? (
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {categories.map((category) => (
                            <Link
                                key={category.id}
                                href={`/blog/${category.slug}`}
                                className="group bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow overflow-hidden"
                            >
                                <div className="relative h-48 w-full">
                                    {category.image_url ? (
                                        <Image
                                            src={category.image_url}
                                            alt={category.title}
                                            fill
                                            className="object-cover transition-transform duration-500 group-hover:scale-105"
                                            sizes="(max-width: 768px) 100vw, 33vw"
                                        />
                                    ) : (
                                        <div className="w-full h-full bg-gray-100 flex items-center justify-center">
                                            <span className="text-gray-400">Нет изображения</span>
                                        </div>
                                    )}
                                    <div className="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent" />
                                </div>
                                <div className="p-4">
                                    <h3 className="text-lg font-bold text-[#218CE9] mb-2">
                                        {category.title}
                                    </h3>
                                    {category.description && (
                                        <p className="text-gray-600 line-clamp-3">
                                            {category.description}
                                        </p>
                                    )}
                                </div>
                            </Link>
                        ))}
                    </div>
                ) : (
                    <div className="text-center text-red-500">
                        Записи блога временно недоступны
                    </div>
                )}
                <div className="text-center mt-6">
                    <Link href="/blog" className="text-[#218CE9] hover:underline">
                        Смотреть все записи
                    </Link>
                </div>
            </section>
        </div>

    );
}
// BurgerMenu.tsx
"use client";
import { useState } from "react";
import Link from "next/link";
import { FaInstagram, FaTelegram, FaVk } from "react-icons/fa";

interface NavLink {
  href: string;
  text: string;
}

interface BurgerMenuProps {
  navLinks: NavLink[];
}

const BurgerMenu: React.FC<BurgerMenuProps> = ({ navLinks }) => {
  const [isOpen, setIsOpen] = useState(false);

  const toggleMenu = () => setIsOpen(!isOpen);
  const closeMenu = () => setIsOpen(false);

  return (
    <div className="relative">
      <button
        onClick={toggleMenu}
        className="p-2 focus:outline-none text-[#218CE9] hover:text-[#1a6fb9] transition-colors"
      >
        <svg
          className="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
      </button>

      {isOpen && (
        <div className="fixed inset-0 z-40 bg-black/50 lg:hidden" onClick={closeMenu}>
          <div
            className="absolute left-0 top-0 h-full w-64 bg-white shadow-lg"
            onClick={(e) => e.stopPropagation()}
          >
            <div className="p-4 border-b">
              <button
                onClick={closeMenu}
                className="text-gray-500 hover:text-[#218CE9] transition-colors"
              >
                ✕
              </button>
            </div>

            <ul className="py-2">
              {navLinks.map((link) => (
                <li key={link.href}>
                  <Link
                    href={link.href}
                    onClick={closeMenu}
                    className="block px-6 py-3 text-gray-700 hover:bg-[#218CE9]/10 hover:text-[#218CE9] transition-colors"
                  >
                    {link.text}
                  </Link>
                </li>
              ))}
              <li>
                <Link
                  href="/contacts"
                  onClick={closeMenu}
                  className="block px-6 py-3 mt-2 bg-[#218CE9] text-white hover:bg-[#1a6fb9]"
                >
                  Оставить заявку
                </Link>
              </li>
            </ul>

            <div className="flex justify-between gap-4 mt-4 px-6">
              <a href="https://vk.com/aquaservice_ptz" target="_blank" rel="noopener" className="text-[#218CE9] hover:text-[#1a6fb9]">
                <FaVk className="w-10 h-10" />
              </a>
              <a href="https://telegram.org" target="_blank" rel="noopener" className="text-[#218CE9] hover:text-[#1a6fb9]">
                <FaTelegram className="w-10 h-10" />
              </a>
              <a href="https://www.instagram.com/aquaservice.ptz/" target="_blank" rel="noopener" className="text-[#218CE9] hover:text-[#1a6fb9]">
                <FaInstagram className="w-10 h-10" />
              </a>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default BurgerMenu;// components/CategoryCard.tsx
'use client'
import Image from "next/image";

interface CategoryCardProps {
  category: {
    id: number;
    name: string;
    image_url: string;
    description: string;
  };
}

export default function CategoryCard({ category }: CategoryCardProps) {
  return (
    <a
      href={`/equipment/${encodeURIComponent(category.name)}`}
      className="group relative block overflow-hidden rounded-xl shadow-md hover:shadow-lg transition-transform duration-300 hover:-translate-y-2"
    >
      <div className="relative h-48 w-full">
        <Image
          src={category.image_url}
          alt={category.name}
          fill
          className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
          sizes="(max-width: 768px) 100vw, 50vw"
          priority
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent" />
      </div>

      <div className="absolute bottom-0 left-0 right-0 p-4 text-white">
        <h2 className="text-xl font-bold mb-1 drop-shadow-lg">
          {category.name}
        </h2>
        <p className="text-sm line-clamp-2 opacity-90 group-hover:opacity-100 transition-opacity">
          {category.description}
        </p>
      </div>
    </a>
  );
}'use client'
import Image from "next/image";
import { useEffect, useState } from "react";
import { getBlurDataURL } from "@/lib/image-utils";
import Link from 'next/link';

interface EquipmentCardProps {
  equipment: {
    id: number;
    title: string;
    description: string;
    price: number;
    image_url: string;
    category: string;
    slug: string;
  };
}

export default function EquipmentCard({ equipment }: EquipmentCardProps) {
  const [blurData, setBlurData] = useState<string>("");

  useEffect(() => {
    getBlurDataURL(equipment.image_url)
      .then(setBlurData)
      .catch((error) => {
        console.error("Ошибка загрузки blurData:", error);
        setBlurData(""); 
      });
  }, [equipment.image_url]);

  return (
    <Link 
      href={`/equipment/${encodeURIComponent(equipment.category)}/${equipment.slug}`}
      className="group block bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-6 h-full"
    >
      <div className="relative h-48 w-full mb-4 flex-shrink-0">
        <Image
          src={equipment.image_url}
          alt={equipment.title}
          fill
          className="object-cover rounded-lg transition-transform group-hover:scale-105"
          sizes="(max-width: 768px) 100vw, 33vw"
          loading="lazy"
          {...(blurData ? { placeholder: "blur", blurDataURL: blurData } : {})}
        />
      </div>
      
      <h3 className="text-xl font-bold text-[#218CE9] mb-2 group-hover:text-[#1a6fb9] transition-colors">
        {equipment.title}
      </h3>
      
      <p className="text-gray-600 mb-4 flex-grow">{equipment.description}</p>
      
      <div className="flex justify-between items-center mt-auto">
        <span className="font-bold text-[#218CE9]">
          от {equipment.price.toLocaleString('ru-RU')} ₽
        </span>
        <span className="text-sm bg-blue-100 text-[#218CE9] px-3 py-1 rounded-full">
          {equipment.category}
        </span>
      </div>
    </Link>
  );
}// components/EquipmentCategoryCard.tsx
import Link from 'next/link';
import Image from 'next/image';

interface EquipmentCategoryCardProps {
  category: {
    name: string;
    image_url: string | null;
    description?: string;
  };
}

export default function EquipmentCategoryCard({ category }: EquipmentCategoryCardProps) {
  return (
    <Link
      href={`/equipment/${encodeURIComponent(category.name)}`}
      className="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow overflow-hidden"
    >
      <div className="relative h-48 w-full">
        {
          category.image_url ? (
            <Image
              src={category.image_url}
              alt={category.name}
              fill
              className="object-cover"
              sizes="(max-width: 768px) 100vw, 33vw"
            />
          ) : (
            <div className="w-full h-full bg-gray-100 flex items-center justify-center">
              <span className="text-gray-400">Нет изображения</span>
            </div>
          )
        }
      </div>

      <div className="p-6">
        <h2 className="text-xl font-bold text-[#218CE9] mb-2">
          {category.name}
        </h2>
        {category.description && (
          <p className="text-gray-600 line-clamp-3">
            {category.description}
          </p>
        )}
      </div>
    </Link>
  );
}// components/EquipmentSlider.tsx - Слайдер оборудования на главной (app/page.tsx)
"use client";
import React, { useEffect, useState } from "react";
import useEmblaCarousel from "embla-carousel-react";
import Autoplay from "embla-carousel-autoplay";
import { WheelGesturesPlugin } from "embla-carousel-wheel-gestures";
import Image from "next/image";
import Link from "next/link";
import { supabase } from '@/lib/supabase';

// Тип данных для оборудования
interface Equipment {
  id: string;
  title: string;
  description: string;
  price: string;
  image_url: string;
  category: string;
}

const EquipmentSlider = () => {
  // Состояния компонента
  const [equipment, setEquipment] = useState<Equipment[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedIndex, setSelectedIndex] = useState(0);

  // Инициализация слайдера
  const [emblaRef, emblaApi] = useEmblaCarousel(
    {
      loop: true,
      align: "start",
      breakpoints: {
        "(min-width: 640px)": { slidesToScroll: 1 },
        "(min-width: 1024px)": { slidesToScroll: 1 }
      }
    },
    [Autoplay({ delay: 5000 }), WheelGesturesPlugin()]
  );

  // Загрузка данных
  useEffect(() => {
    const fetchEquipment = async () => {
      try {
        const { data, error } = await supabase
          .from('equipment')
          .select('*')
          .order('price', { ascending: true });

        if (error) throw error;
        setEquipment(data || []);
      } catch (err) {
        setError('Ошибка загрузки оборудования');
        console.error('Ошибка:', err);
      } finally {
        setLoading(false);
      }
    };

    fetchEquipment();
  }, []);

  // Обработчик изменения слайда
  useEffect(() => {
    if (!emblaApi) return;
    const updateIndex = () => setSelectedIndex(emblaApi.selectedScrollSnap());
    emblaApi.on("select", updateIndex);
    return () => {
      emblaApi.off("select", updateIndex);
    };
  }, [emblaApi]);

  // Состояния загрузки
  if (loading) {
    return (
      <div className="text-center py-12">
        <div className="animate-pulse bg-gray-200 h-64 rounded-xl w-full max-w-4xl mx-auto" />
      </div>
    );
  }

  // Обработка ошибок
  if (error) {
    return (
      <div className="text-red-500 text-center py-8">
        {error}. Обновите страницу
      </div>
    );
  }

  return (
    <section className="px-4 py-8 container mx-auto">
      <div className="border-b border-black/10 mb-8"></div>

      <h2 className="text-center font-bold text-3xl text-[#218CE9] mb-8">
        КАКОЕ ОБОРУДОВАНИЕ У НАС ЗАКАЗЫВАЮТ
      </h2>

      <div className="flex items-center gap-4">
        {/* Навигационные кнопки */}
        <button
          onClick={() => emblaApi?.scrollPrev()}
          className="hidden md:flex items-center justify-center w-10 h-10 rounded-full bg-white shadow-lg hover:scale-110 transition-transform"
        >
          <svg className="w-6 h-6 text-[#218CE9]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>

        {/* Контейнер слайдов */}
        <div className="embla overflow-hidden flex-1" ref={emblaRef}>
          <div className="embla__container flex gap-3">
            {equipment.map((item) => (
              <div
                className="embla__slide flex-[0_0_280px]"
                key={item.id}
              >
                <article className="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow h-full flex flex-col">
                  <div className="relative h-48">
                    <Image
                      src={item.image_url}
                      alt={item.title}
                      fill
                      className="object-cover rounded-t-xl"
                      sizes="(max-width: 768px) 100vw, 50vw"
                    />
                  </div>

                  <div className="p-4 flex flex-col flex-grow">
                    <h3 className="text-xl font-bold text-[#218CE9] mb-2">
                      {item.title}
                    </h3>

                    <p className="text-gray-600 text-sm mb-4 flex-grow">
                      {item.description}
                    </p>

                    <div className="mt-auto">
                      <p className="text-lg font-bold text-[#218CE9] mb-3">
                        от {item.price} ₽
                      </p>
                      <button className="w-full bg-[#218CE9] text-white py-2 rounded-lg hover:bg-[#1a6fb9] transition-colors">
                        Подробнее
                      </button>
                    </div>
                  </div>
                </article>
              </div>
            ))}
          </div>
        </div>

        <button
          onClick={() => emblaApi?.scrollNext()}
          className="hidden md:flex items-center justify-center w-10 h-10 rounded-full bg-white shadow-lg hover:scale-110 transition-transform"
        >
          <svg className="w-6 h-6 text-[#218CE9]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </div>

      {/* Пагинация */}
      <div className="flex justify-center gap-2 mt-6">
        {equipment.map((_, index) => (
          <button
            key={index}
            onClick={() => emblaApi?.scrollTo(index)}
            className={`w-2 h-2 rounded-full transition-opacity ${selectedIndex === index ? 'opacity-100' : 'opacity-30'
              } bg-[#218CE9]`}
          />
        ))}
      </div>

      {/* Кнопка "Посмотреть все" */}
      <div className="flex justify-center mt-8">
        <Link
          href="/equipment"
          className="bg-[#218CE9] text-white px-6 py-2 rounded-full hover:bg-[#1a6fb9] transition-colors"
        >
          Весь каталог →
        </Link>
      </div>
    </section>
  );
};

export default EquipmentSlider;// src/app/components/Footer.tsx
'use client'
import React from 'react'
import Link from 'next/link'
import { FiPhone, FiMapPin, FiMail, FiClock } from 'react-icons/fi'
import { FaVk, FaTelegram, FaInstagram } from 'react-icons/fa'
const Footer = () => {
  return (
    <footer className="w-full bg-white border-t border-gray-100 mt-16">
      <div className="container mx-auto px-4 py-12 ">
        {/* Основные разделы */}
        <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 justify-items-center gap-8 mb-12">
          {/* Контакты */}
          <div className="">
            <h3 className="text-xl font-bold text-[#218CE9] mb-4">Контакты</h3>
            <div className="space-y-3">
              <div className="flex items-center gap-3">
                <FiMapPin className="w-5 h-5 text-[#218CE9] mt-1" />
                <div>
                  <p className="text-gray-600">
                    г. Петрозаводск, <br /> ул. Коммунистов, 50/2
                  </p>
                </div>
              </div>

              <div className="flex items-center gap-3">
                <FiPhone className="w-5 h-5 text-[#218CE9]" />
                <div className="flex gap-4">
                  <a href="tel:8142270545" className="text-gray-600 hover:text-[#218CE9]">27-05-45</a>
                  <a href="tel:8142330090" className="text-gray-600 hover:text-[#218CE9]">33-00-90</a>
                </div>
              </div>

              <div className="flex items-center gap-3">
                <FiMail className="w-5 h-5 text-[#218CE9]" />
                <a href="mailto:info@aqua-ptz.ru" className="text-gray-600 hover:text-[#218CE9]">
                  info@aqua-ptz.ru
                </a>
              </div>

              <div className="flex items-center gap-3">
                <FiClock className="w-5 h-5 text-[#218CE9]" />
                <p className="text-gray-600">пн-пт: 09:00–18:00</p>
              </div>
            </div>
          </div>

          {/* Навигация */}
          <div>
            <h3 className="text-xl font-bold text-[#218CE9] mb-4">Навигация</h3>
            <ul className="space-y-3">
              {[
                { href: '/', text: 'Главная' },
                { href: '/services', text: 'Услуги' },
                { href: '/equipment', text: 'Оборудование' },
                { href: '/blog', text: 'Блог' },
                { href: '/contacts', text: 'Контакты' },
              ].map((item) => (
                <li key={item.href}>
                  <Link href={item.href} className="text-gray-600 hover:text-[#218CE9] transition-colors">
                    {item.text}
                  </Link>
                </li>
              ))}
            </ul>
          </div>

          {/* Документы */}
          {/* <div>
            <h3 className="text-xl font-bold text-[#218CE9] mb-4">Документы</h3>
            <ul className="space-y-3">
              {[
                { href: '/privacy', text: 'Политика конфиденциальности' },
                { href: '/terms', text: 'Пользовательское соглашение' },
                { href: '/guarantee', text: 'Гарантии и возврат' },
                { href: '/license', text: 'Лицензии' },
              ].map((item) => (
                <li key={item.href}>
                  <Link href={item.href} className="text-gray-600 hover:text-[#218CE9] transition-colors">
                    {item.text}
                  </Link>
                </li>
              ))}
            </ul>
          </div> */}

          {/* Соцсети */}
          <div>
            <h3 className="text-xl font-bold text-[#218CE9] mb-4">Мы в соцсетях</h3>
            <div className="flex gap-4">
              {[
                { icon: <FaVk  className="w-10 h-10" />, href: 'https://vk.com/aquaservice_ptz', label: 'ВКонтакте' },
                { icon: <FaTelegram className="w-10 h-10" />, href: '/telegram', label: 'Telegram' },
                { icon: <FaInstagram className="w-10 h-10" />, href: 'https://www.instagram.com/aquaservice.ptz/', label: 'Instagram' },
              ].map((item) => (
                <a
                  key={item.href}
                  href={item.href}
                  className="text-2xl text-gray-600 hover:text-[#218CE9] transition-colors"
                  aria-label={item.label}
                >
                  {item.icon}
                </a>
              ))}
            </div>
          </div>
        </div>


        {/* Копирайт */}
        <div className="border-t border-black border-opacity-10 pt-6 text-center">
          <p className="text-gray-500 text-sm">
            © 2000-{new Date().getFullYear()} ООО «АкваСервис». Все права защищены
          </p>
        </div>
      </div>
    </footer>
  )
}

export default Footer'use client'
import { Swiper, SwiperSlide } from 'swiper/react'
import { Autoplay, EffectFade, Navigation, Pagination } from 'swiper/modules'
import 'swiper/css'
import 'swiper/css/effect-fade'
import 'swiper/css/navigation'
import 'swiper/css/pagination'
import Image from 'next/image'
import { FiCheckCircle, FiArrowDown } from 'react-icons/fi'

const cities = [
  'Петрозаводск', 'Кондопога', 'Медвежьегорск',
  'Пряжа', 'Шуя', 'Деревянное',
  'Сортавала', 'Лахденпохья', 'Питкяранта',
  'Олонец', 'Суоярви', 'Сегежа'
];

const FullscreenSlider = ({ scrollToForm }: { scrollToForm: () => void }) => {
  return (
    <div className="relative">
      <Swiper
        modules={[Autoplay, EffectFade, Navigation, Pagination]}
        effect="fade"
        speed={1200}
        navigation
        pagination={{ clickable: true }}
        autoplay={{ delay: 10000, pauseOnMouseEnter: true }}
        className="h-screen w-full"
      >
        {/* Слайд 1: Главный */}
        <SwiperSlide className="relative bg-gradient-to-b from-blue-900 to-cyan-900 flex items-center">
          <div className="container mx-auto h-full flex flex-col items-center px-4 py-12">
            <div className="w-full max-w-6xl mx-auto text-center">
              {/* Заголовок */}
              <h1 className="text-3xl xs:text-4xl sm:text-5xl md:text-6xl font-bold uppercase mb-6 text-white">
                БУРЕНИЕ СКВАЖИН В РЕСПУБЛИКЕ КАРЕЛИЯ
                <span className="block text-lg xs:text-xl sm:text-2xl md:text-3xl font-normal mt-3">
                  С ГАРАНТИЕЙ 10 ЛЕТ
                </span>
              </h1>

              {/* Мобильный вариант */}
              <div className="md:hidden space-y-6 mb-8">
                {/* Преимущества */}
                {[
                  'Полный цикл работ "под ключ"',
                  'Лицензированное оборудование',
                  'Сертифицированные специалисты'
                ].map((item, i) => (
                  <div
                    key={i}
                    className="bg-white/10 p-4 rounded-xl backdrop-blur-sm flex items-center gap-3"
                  >
                    <FiCheckCircle className="text-2xl text-[#218CE9] flex-shrink-0" />
                    <span className="text-lg text-white/90">{item}</span>
                  </div>
                ))}

                {/* Автоматическая прокрутка городов */}
                <div className="bg-white/5 p-6 rounded-2xl backdrop-blur-sm">
                  <h2 className="text-xl font-bold text-white mb-4 text-center">
                    Основные населенные пункты:
                  </h2>
                  <div className="overflow-hidden">
                    <div className="flex animate-infinite-scroll">
                      {[...cities, ...cities].map((city, i) => (
                        <div
                          key={i}
                          className="bg-white/10 px-4 py-2 rounded-lg text-white/90 text-sm flex-shrink-0 mr-2"
                        >
                          {city}
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
                <button
                  onClick={scrollToForm}
                  className="w-full bg-[#218CE9] text-white py-3 rounded-full font-bold hover:bg-[#1a6fb9] flex items-center justify-center gap-2"
                >
                  <FiArrowDown className="animate-bounce" />
                  Оставить заявку
                </button>
              </div>

              {/* Desktop вариант */}
              <div className="hidden md:grid md:grid-cols-2 gap-8 mb-8">
                {/* Левая колонка */}
                <div className="space-y-6">
                  <div className="space-y-4">
                    {[
                      'Полный цикл работ "под ключ"',
                      'Лицензированное оборудование',
                      'Сертифицированные специалисты'
                    ].map((item, i) => (
                      <div
                        key={i}
                        className="bg-white/10 p-4 rounded-xl backdrop-blur-sm flex items-center gap-3"
                      >
                        <FiCheckCircle className="text-2xl text-[#218CE9] flex-shrink-0" />
                        <span className="text-lg text-white/90">{item}</span>
                      </div>
                    ))}
                  </div>

                  <div className="grid grid-cols-3 gap-3 text-center">
                    {[
                      { value: '15+', label: 'лет опыта' },
                      { value: '1,200+', label: 'скважин пробурено' },
                      { value: '98%', label: 'рекомендуют нас' }
                    ].map((item, i) => (
                      <div key={i} className="bg-white/10 p-4 rounded-xl">
                        <div className="text-2xl font-bold text-[#218CE9]">{item.value}</div>
                        <div className="text-sm text-white/80 mt-1">{item.label}</div>
                      </div>
                    ))}
                  </div>

                  <button
                    onClick={scrollToForm}
                    className="bg-[#218CE9] hover:bg-[#1666b3] text-white px-8 py-4 rounded-full 
                       w-full flex items-center justify-center gap-2 text-lg font-semibold
                       transition-all duration-300"
                  >
                    <FiArrowDown className="text-xl animate-bounce" />
                    Заказать звонок
                  </button>
                </div>

                {/* Правая колонка */}
                <div className="bg-white/5 p-6 rounded-2xl backdrop-blur-sm">
                  <h2 className="text-xl font-bold text-white mb-4 text-center">
                    Основные населенные пункты:
                  </h2>
                  <div className="flex flex-wrap gap-2 max-h-[400px] overflow-y-auto">
                    {cities.map((city, i) => (
                      <div
                        key={i}
                        className="bg-white/10 px-4 py-2 rounded-lg text-white/90 text-sm"
                      >
                        {city}
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </SwiperSlide>


        {/* Слайд 2: Услуги */}
        <SwiperSlide className="relative bg-gradient-to-br from-[#218CE9] to-cyan-400">
          <div className="absolute inset-0 opacity-15 z-0">
            <svg viewBox="0 0 500 200" className="w-full h-full" preserveAspectRatio="none">
              <path fill="currentColor" d="M0 120 Q 125 60 250 120 T 500 120 L500 0 0 0" className="text-white">
                <animate
                  attributeName="d"
                  dur="15s"
                  repeatCount="indefinite"
                  values="
            M0 120 Q 125 60 250 120 T 500 120 L500 0 0 0;
            M0 120 Q 125 180 250 120 T 500 120 L500 0 0 0;
            M0 120 Q 125 60 250 120 T 500 120 L500 0 0 0
          "
                />
              </path>
            </svg>
          </div>
          <div className="container mx-auto px-4 h-full flex items-center relative z-10">
            <div className="w-full h-[80vh] flex flex-col">
              <div className="space-y-4 md:space-y-8">
                <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-white drop-shadow-lg">
                  Наши ключевые услуги
                  <div className="mt-2 md:mt-4 text-lg md:text-xl lg:text-2xl font-light opacity-90">
                    Профессиональные решения для вашего комфорта
                  </div>
                </h2>
              </div>

              <div className="flex-1 overflow-y-auto pb-8 mt-4">
                <div className="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4 lg:gap-6 px-2">
                  {[
                    {
                      icon: '⛏️',
                      title: 'Бурение скважин',
                      items: [
                        'Бурение на песчаный/гравийно-галечный грунт',
                        'Инженерно-геологические изыскания',
                        'Ремонт аварийных скважин',
                        'Устранение самоизлива'
                      ],
                      accent: 'bg-blue-100'
                    },
                    {
                      icon: '⚙️',
                      title: 'Обустройство скважин',
                      items: [
                        'Подбор и монтаж насосов',
                        'Установка кессонов',
                        'Прокладка коммуникаций',
                        'Монтаж водоприемного узла'
                      ],
                      accent: 'bg-blue-100'
                    },
                    {
                      icon: '💧',
                      title: 'Водоочистка',
                      items: [
                        'Химический анализ воды',
                        'Подбор оборудования',
                        'Монтаж и наладка систем',
                        'Сервисное обслуживание'
                      ],
                      accent: 'bg-blue-100'
                    },
                    {
                      icon: '🚽',
                      title: 'Автономная канализация',
                      items: [
                        'Анализ местности',
                        'Подбор оборудования',
                        'Монтаж очистных сооружений',
                        'Обслуживание систем'
                      ],
                      accent: 'bg-blue-100'
                    }
                  ].map((service, index) => (
                    <div
                      key={index}
                      className="group p-4 md:p-6 bg-white rounded-xl md:rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 border-2 border-white/20 relative overflow-hidden"
                    >
                      <div className={`absolute top-0 left-0 w-full h-1.5 md:h-2 ${service.accent}`}></div>
                      <div className="mt-2">
                        <div className={`mb-3 md:mb-4 p-2 md:p-3 rounded-lg ${service.accent} inline-block shadow-sm md:shadow-md`}>
                          <span className="text-3xl md:text-4xl text-[#218CE9]">{service.icon}</span>
                        </div>
                        <h3 className="text-lg md:text-xl font-bold text-gray-800 mb-2 md:mb-3">
                          {service.title}
                        </h3>
                        <ul className="space-y-1 md:space-y-2 text-gray-600">
                          {service.items.map((item, i) => (
                            <li key={i} className="flex items-start gap-2 text-xs md:text-sm leading-4 md:leading-5">
                              <span className="text-[#218CE9] text-base mt-0.5">•</span>
                              {item}
                            </li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </SwiperSlide>

        {/* Слайд 3: Галерея */}
        <SwiperSlide className="relative bg-gradient-to-br from-blue-50 to-cyan-50 min-h-screen">
          <div className="container mx-auto h-full flex flex-col justify-center py-8">
            <div className="text-center mb-6 px-4">
              <h2 className="text-3xl font-bold text-[#218CE9] mb-2">Реализованные проекты</h2>
              <p className="text-gray-600 text-base max-w-md mx-auto">
                Более 1200 успешных объектов по всей стране
              </p>
            </div>
            <div className="flex-1 overflow-y-auto px-4">
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {[
                  {
                    id: 1,
                    title: "Система аэрации",
                    location: "Московская область",
                    depth: null,
                    description: "Комплексная система очистки воды с напорной аэрацией",
                    image: "/images/aeration-system.webp"
                  },
                  {
                    id: 2,
                    title: "Станция биоочистки Юнилос Астра 5",
                    location: "с. Ведлозеро, Пряжинский р-н",
                    depth: null,
                    description: "Монтаж автономной канализации для частного дома",
                    image: "/images/unilos-setup.webp"
                  },
                  {
                    id: 3,
                    title: "Очистные сооружения",
                    location: "Калужская область",
                    depth: null,
                    description: "Многоступенчатая система фильтрации для коттеджного поселка",
                    image: "/images/filtration-system.webp"
                  },
                  {
                    id: 4,
                    title: "Водоподготовка",
                    location: "Тверская область",
                    depth: null,
                    description: "Установка умягчителя и обезжелезивателя",
                    image: "/images/water-treatment.webp"
                  },
                  {
                    id: 5,
                    title: "Скважина на песок",
                    location: "Новгородская область",
                    depth: "32",
                    description: "Неглубокая скважина с насосной станцией",
                    image: "/images/sand-well.webp"
                  },
                  {
                    id: 6,
                    title: "Автоматизация",
                    location: "Владимирская область",
                    depth: null,
                    description: "Система умного управления водоснабжением",
                    image: "/images/automation-system.webp"
                  }
                ].map((project) => (
                  <div key={project.id} className="relative aspect-square bg-white rounded-lg shadow-md overflow-hidden">
                    <Image
                      src={project.image}
                      alt={project.title}
                      width={400}
                      height={400}
                      className="object-cover w-full h-full"
                    />
                    <div className="absolute bottom-0 left-0 right-0 bg-white/90 p-3">
                      <h3 className="text-[#218CE9] font-bold text-sm mb-1">{project.title}</h3>
                      <p className="text-gray-600 text-xs mb-1">{project.description}</p>
                      <div className="flex justify-between items-center text-xs">
                        <span className="text-gray-600">{project.location}</span>
                        {project.depth && <span className="text-[#218CE9]">{project.depth}м</span>}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
            <div className="text-center pt-6 sticky bottom-4 z-10">
              <button className="bg-[#218CE9] text-white px-8 py-3 rounded-full hover:bg-[#1a6fb9] transition-colors">
                Все проекты
              </button>
            </div>
          </div>
        </SwiperSlide>
      </Swiper>
    </div>
  )
}

export default FullscreenSlider
// Header.tsx
'use client'
import React, { useState, useEffect, useCallback } from "react";
import Link from "next/link";
import BurgerMenu from "./BurgerMenu";
import { FiPhone, FiClock, FiMapPin, FiMail } from "react-icons/fi";
import Image from "next/image";
import { FaInstagram, FaTelegram, FaVk } from "react-icons/fa";

const Header = () => {
  const [showTopBar, setShowTopBar] = useState(true);
  const [lastScrollY, setLastScrollY] = useState(0);

  const controlNavbar = useCallback(() => {
    if (window.scrollY > lastScrollY && window.scrollY > 50) {
      setShowTopBar(false);
    } else {
      setShowTopBar(true);
    }
    setLastScrollY(window.scrollY);
  }, [lastScrollY]);

  useEffect(() => {
    window.addEventListener('scroll', controlNavbar);
    return () => {
      window.removeEventListener('scroll', controlNavbar);
    };
  }, [controlNavbar]);

  const navLinks = [
    { href: "/", text: "Главная" },
    { href: "/services", text: "Услуги" },
    { href: "/equipment", text: "Оборудование" },
    { href: "/about", text: "О нас" },
    { href: "/blog", text: "Блог" },
    { href: "/contacts", text: "Контакты" },
  ];

  return (
    <>
      {/* Верхняя контактная панель */}
      <div className={`sticky top-0 z-50 bg-white border-b transition-transform duration-300 ${showTopBar ? 'translate-y-0' : '-translate-y-full'}`}>
        <div className="container mx-auto px-4 py-1.5 flex flex-wrap items-center justify-center text-[11px] sm:text-sm text-gray-600 text-center gap-x-3 gap-y-1 md:justify-between">
          {/* Левый блок - Телефоны */}
          <div className="flex items-center space-x-1.5">
            <FiPhone className="w-3 h-3 sm:w-4 sm:h-4" />
            <div className="flex divide-x divide-gray-400">
              <a href="tel:8142270545" className="hover:text-[#218CE9] px-1.5">27-05-45</a>
              <a href="tel:8142330090" className="hover:text-[#218CE9] px-1.5">33-00-90</a>
            </div>
          </div>

          {/* Центр - Время работы */}
          <div className="flex items-center space-x-1.5">
            <FiClock className="w-3 h-3 sm:w-4 sm:h-4" />
            <span>пн-пт: 09:00–18:00</span>
          </div>

          {/* Правый блок - Адрес и почта */}
          <div className="flex items-center space-x-1.5">
            <FiMapPin className="w-3 h-3 sm:w-4 sm:h-4" />
            <span className="truncate  sm:max-w-none">ул. Коммунистов, 50/2</span>
          </div>

          <div className="flex items-center space-x-1.5">
            <FiMail className="w-3 h-3 sm:w-4 sm:h-4" />
            <a href="mailto:info@aqua-ptz.ru" className="hover:text-[#218CE9] truncate max-w-[120px]">info@aqua-ptz.ru</a>
          </div>

        </div>
      </div>
      {/* Основной header */}
      <header className="sticky top-0 z-50 bg-white shadow-md">
        <div className="container mx-auto px-4">
          <div className="flex items-center justify-between h-14 md:h-16">
            {/* Левая часть */}
            <div className="flex items-center gap-2 md:gap-4">
              <div className="lg:hidden">
                <BurgerMenu navLinks={navLinks} />
              </div>

              <Link href="/" className="relative h-10 w-28 md:h-12 md:w-40">
                <Image
                  src="/images/logo-aqu-servise.png"
                  alt="АкваСервис бурение скважин Петрозаводск"
                  fill
                  className="object-contain"
                  priority
                  sizes="(max-width: 160px) 100vw, 50vw"
                />
              </Link>
            </div>

            {/* Центральная навигация */}
            <nav
              aria-label="Основное меню"
              className="hidden lg:flex items-center gap-3 mx-3 flex-1 justify-end">
              {navLinks.map((link) => (
                <Link
                  key={link.href}
                  href={link.href}
                  className="text-clamp font-medium text-gray-700 hover:text-[#218CE9] transition-colors whitespace-nowrap"
                >
                  {link.text}
                </Link>
              ))}
            </nav>
            <div className="flex items-center gap-4 px-4">
              <a href="https://vk.com/aquaservice_ptz" target="_blank" rel="noopener" className="text-[#218CE9] hover:text-[#1a6fb9]">
                <FaVk className="w-7 h-7" />
              </a>
              <a href="https://telegram.org" target="_blank" rel="noopener" className="text-[#218CE9] hover:text-[#1a6fb9]">
                <FaTelegram className="w-7 h-7" />
              </a>
              <a href="https://www.instagram.com/aquaservice.ptz/" target="_blank" rel="noopener" className="text-[#218CE9] hover:text-[#1a6fb9]">
                <FaInstagram className="w-7 h-7" />
              </a>
            </div>
            {/* Кнопка заявки */}
            <div className="hidden items-center gap-3 lg:flex">
              <Link
                href="/contacts"
                className="bg-[#218CE9] text-white px-6 py-2 rounded-lg hover:bg-[#1a6fb9] transition-colors whitespace-nowrap "
              >
                Оставить заявку
              </Link>
            </div>

            
          </div>
        </div>
      </header>
    </>
  );
};

export default Header;import React from "react";
import Image from "next/image";

const Hero = () => {
    return (
        <section className="container mx-auto sm:hidden w-full p-4 bg-gradient-to-b from-blue-100 to-white text-left">
            {/* Заголовок */}
            <h2 className="text-[#218CE9] text-3xl font-bold mb-4 text-center">
                БУРЕНИЕ СКВАЖИН ПОД КЛЮЧ
            </h2>

            {/* Описание */}
            <p className="text-black text-opacity-60 text-sm max-w-2xl mx-auto mb-6">
                Профессиональное обустройство источников воды с гарантией 10 лет.
                Учитываем особенности вашего участка, чтобы обеспечить чистой водой круглый год.
            </p>

            {/* Кнопка */}
            <button className="w-full px-8 py-3 bg-[#218CE9] text-white text-base font-bold rounded-[62px] hover:bg-[#1a70c0] transition-colors duration-200">
                Заказать звонок
            </button>

            {/* Блок статистики */}
            <div className="max-w-xl mx-auto">
                <div className="grid grid-cols-2 gap-4 mt-5 mx-5">
                    <div className="text-left">
                        <div className="text-2xl font-bold text-[#218CE9]">15+</div>
                        <div className="text-xs text-gray-600 mt-1">
                            Лет опыта на рынке
                        </div>
                    </div>

                    <div className="text-left">
                        <div className="text-2xl font-bold text-[#218CE9]">
                            1,200+
                        </div>
                        <div className="text-xs text-gray-600 mt-1">
                            Скважин с 2010 года
                        </div>
                    </div>

                    <div className="col-span-2">
                        <div className="w-fit mx-auto text-center">
                            <div className="text-2xl font-bold text-[#218CE9]">98%</div>
                            <div className="text-xs text-gray-600 mt-1">
                                Клиентов рекомендуют нас
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <Image
                src="/images/hero.jpeg"
                alt="Статистика бурения"
                width={800}
                height={600}
                className="mt-5 w-full mx-auto rounded-[20px]"
                priority
            />
        </section>
    );
};

export default Hero;// components/LocalBusinessSchema.tsx
export const LocalBusinessSchema = () => (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{
        __html: JSON.stringify({
          "@context": "https://schema.org",
          "@type": "LocalBusiness",
          "name": "АкваСервис",
          "image": "https://aqua-service-karelia.ru/logo.jpg",
          "priceRange": "от 20 000 ₽",
          "address": {
            "@type": "PostalAddress",
            "streetAddress": "ул. Коммунистов, д.50, стр.2",
            "addressLocality": "Петрозаводск",
            "addressRegion": "Карелия",
            "postalCode": "185035"
          },
          "geo": {
            "@type": "GeoCoordinates",
            "latitude": 61.785474,
            "longitude": 34.346939
          }
        })
      }}
    />
  );'use client';

const MapIframe = () => {
  return (
    <div className="relative w-full aspect-video rounded-xl overflow-hidden shadow-xl">
      <iframe
        src="https://yandex.ru/map-widget/v1/?um=constructor%3Ad9c2ce5f3f93b1220e44539e76f2fae4b500f45a0280f9c51d63abbfd1dfa625&amp;source=constructor"
        className="absolute top-0 left-0 w-full h-full"
        title="Карта"
        loading="lazy"
      />
    </div>
  );
};

export default MapIframe;
'use client';

export const MapPlaceholder = () => {
  return (
    <div className="w-full bg-gray-100 rounded-xl animate-pulse h-96">
      <div className="flex items-center justify-center h-full text-gray-500">
        <svg className="w-12 h-12 animate-spin" fill="none" viewBox="0 0 24 24">
          <circle
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            strokeWidth="4"
            className="opacity-25"
          />
          <path
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            className="opacity-75"
          />
        </svg>
      </div>
    </div>
  );
};
'use client';
import dynamic from 'next/dynamic';
import { MapPlaceholder } from './MapPlaceholder';
import { useInView } from 'react-intersection-observer';

// Динамически импортируем MapIframe, который теперь экспортируется по умолчанию
const MapIframe = dynamic(() => import('./MapIframe'), {
  ssr: false,
  loading: () => <MapPlaceholder />,
});

const MapSection = () => {
  const { ref, inView } = useInView({
    triggerOnce: true,
    threshold: 0.1,
  });

  return (
    <section ref={ref} className="w-full bg-white py-12 px-4 md:px-8">
      {inView && <MapIframe />}
    </section>
  );
};

export default MapSection;
// components/OptimizedImage.tsx
import Image from 'next/image';

export const OptimizedImage = ({ src, alt }: { src: string; alt: string }) => (
  <Image
    src={src}
    alt={alt}
    width={800}
    height={600}
    quality={85}
    loading="lazy"
    placeholder="blur"
    blurDataURL="data:image/png;base64,iVBORw0KGgo..."
    className="rounded-xl"
  />
);'use client'
import React, { useState } from 'react';

type CasingMaterial = 'steel' | 'plastic' | 'asbestos';

const PriceCalculator = () => {
    const [equipment, setEquipment] = useState(false);
    const [waterCleaning, setWaterCleaning] = useState(false);
    const [depth, setDepth] = useState(30);
    const [type, setType] = useState<'sand' | 'artesian'>('sand');
    const [casingMaterial, setCasingMaterial] = useState<'steel' | 'plastic' | 'asbestos'>('steel');

    const CASING_PRICES = {
        steel: 500,
        plastic: 300,
        asbestos: 200
    };

    const calculatePrice = () => {
        const basePrice = type === 'sand' ? 2000 : 3500;
        const depthPrice = depth * (type === 'sand' ? 1500 : 3000);
        const casingPrice = CASING_PRICES[casingMaterial] * depth;
        const equipmentPrice = equipment ? 25000 : 0;
        const cleaningPrice = waterCleaning ? 30000 : 0;

        return (basePrice + depthPrice + casingPrice + equipmentPrice + cleaningPrice).toLocaleString('ru-RU');
    };

    // Исправленный обработчик для материала трубы
    const handleCasingChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
        setCasingMaterial(e.target.value as CasingMaterial);
    };

    return (

        <section
            itemScope
            itemType="https://schema.org/OfferCatalog"
            className="container mx-auto px-4 py-8 bg-white rounded-xl shadow-lg">
            <meta itemProp="name" content="Калькулятор стоимости скважин" />
            <meta itemProp="description" content="Точный расчет стоимости бурения в Карелии" />
            <h2 className="text-3xl md:text-4xl font-bold text-[#218CE9] mb-8 text-center">
                Калькулятор стоимости скважины
            </h2>

            <div className="space-y-8 max-w-md mx-auto">
                {/* Тип скважины */}
                <div className="space-y-4">
                    <label className="block text-lg font-medium text-gray-700">Тип скважины:</label>
                    <select
                        value={type}
                        onChange={(e) => setType(e.target.value as 'sand' | 'artesian')}
                        className="w-full p-3 border-2 border-[#218CE9]/20 rounded-lg text-lg focus:ring-2 focus:ring-[#218CE9]"
                    >
                        <option value="sand">Песчаная</option>
                        <option value="artesian">Артезианская</option>
                    </select>
                </div>

                <div className="border-t border-[#218CE9]/20"></div>

                {/* Материал трубы */}
                <div className="space-y-4 pt-4">
                    <label className="block text-lg font-medium text-gray-700">Материал обсадной трубы:</label>
                    <select
                        value={casingMaterial}
                        onChange={handleCasingChange}
                        className="w-full p-3 border-2 border-[#218CE9]/20 rounded-lg text-lg focus:ring-2 focus:ring-[#218CE9]"
                    >
                        <option value="steel">Сталь</option>
                        <option value="plastic">Пластик</option>
                        <option value="asbestos">Асбест</option>
                    </select>
                </div>

                <div className="border-t border-[#218CE9]/20"></div>

                {/* Глубина скважины */}
                <div className="space-y-4 pt-4">
                    <label className="block text-lg font-medium text-gray-700">
                        Глубина скважины: <span className="text-[#218CE9] font-bold">{depth} м</span>
                    </label>
                    <input
                        type="range"
                        min="10"
                        max="200"
                        value={depth}
                        onChange={(e) => setDepth(Number(e.target.value))}
                        className="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg"
                    />
                    <div className="flex justify-between text-gray-600 text-sm">
                        <span>10 м</span>
                        <span>200 м</span>
                    </div>
                </div>

                <div className="border-t border-[#218CE9]/20"></div>

                {/* Дополнительные опции */}
                <div className="space-y-4 pt-4">
                    <label className="flex items-center space-x-3">
                        <input
                            type="checkbox"
                            checked={equipment}
                            onChange={(e) => setEquipment(e.target.checked)}
                            className="form-checkbox h-6 w-6 text-[#218CE9] rounded focus:ring-[#218CE9]"
                        />
                        <span className="text-lg text-gray-700">Насосное оборудование (+25 000 ₽)</span>
                    </label>

                    <label className="flex items-center space-x-3">
                        <input
                            type="checkbox"
                            checked={waterCleaning}
                            onChange={(e) => setWaterCleaning(e.target.checked)}
                            className="form-checkbox h-6 w-6 text-[#218CE9] rounded focus:ring-[#218CE9]"
                        />
                        <span className="text-lg text-gray-700">Система очистки воды (+30 000 ₽)</span>
                    </label>
                </div>

                {/* Итоговая цена */}
                <div className="border-t border-[#218CE9]/20 pt-6 mt-6">
                    <div className="flex justify-between items-center">
                        <span className="text-xl md:text-2xl font-bold text-[#218CE9]">Итого:</span>
                        <span className="text-2xl md:text-3xl font-bold text-[#218CE9]">
                            {calculatePrice()} ₽
                        </span>
                    </div>
                </div>
            </div>
        </section>
    );
};

export default PriceCalculator;'use client';
import { useState, useCallback, useEffect } from 'react';
import { FiUser, FiPhone, FiMail, FiMapPin, FiCheckCircle, FiX, FiChevronDown, FiUpload } from 'react-icons/fi';
import { IMaskInput } from 'react-imask';

interface YandexSuggestion {
    title?: {
        text: string;
    };
}

const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const SUPABASE_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

const PriceForm = () => {
    const [name, setName] = useState('');
    const [phone, setPhone] = useState('');
    const [email, setEmail] = useState('');
    const [address, setAddress] = useState('');
    const [addressSuggestions, setAddressSuggestions] = useState<string[]>([]);
    const [isModalOpen, setIsModalOpen] = useState(false);
    const [submittedName, setSubmittedName] = useState('');
    const [isSubmitting] = useState(false);
    const [selectedService, setSelectedService] = useState('');
    const [file, setFile] = useState<File | null>(null);
    const [fileError, setFileError] = useState('');
    const [preferredContact, setPreferredContact] = useState('');

    const services = [
        'Консультация',
        'Бурение скважины',
        'Очистка воды',
        'Монтаж канализации',
        'Подбор оборудования',
        'Химический анализ'
    ];

    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
        const selectedFile = e.target.files?.[0];
        if (!selectedFile) return;

        if (selectedFile.size > 5 * 1024 * 1024) {
            setFileError('Максимальный размер файла - 5MB');
            return;
        }

        const allowedTypes = [
            'application/pdf',
            'image/jpeg',
            'image/png',
            'application/msword',
            'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
        ];
        if (!allowedTypes.includes(selectedFile.type)) {
            setFileError('Допустимые форматы: PDF, JPEG, PNG, DOCX');
            return;
        }

        setFile(selectedFile);
        setFileError('');
    };

    useEffect(() => {
        if (selectedService !== 'Очистка воды') {
            setFile(null);
            setFileError('');
        }
    }, [selectedService]);

    const fetchAddressSuggestions = useCallback(async (query: string, signal?: AbortSignal) => {
        if (query.length < 3) {
            setAddressSuggestions([]);
            return;
        }

        try {
            const response = await fetch(`/api/yandexSuggest?query=${encodeURIComponent(query)}`, { signal });
            if (!response.ok) throw new Error(`HTTP error ${response.status}`);

            const data = await response.json();
            const suggestions = (data.results || [])
                .map((item: YandexSuggestion) => item.title?.text || '')
                .filter(Boolean);

            setAddressSuggestions(suggestions);
        } catch (error) {
            if ((error as Error).name !== 'AbortError') {
                console.error("Ошибка подсказок:", error);
            }
        }
    }, []);

    const validateForm = useCallback(() => {
        const errors = [];
        if (!name.trim()) errors.push('Имя');
        if (!phone.match(/^\+7 \(\d{3}\) \d{3}-\d{4}$/)) errors.push('Телефон');
        if (!email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) errors.push('Email');
        if (!address.trim()) errors.push('Адрес');
        if (!preferredContact.trim()) errors.push('Способ связи');
        return errors;
    }, [name, phone, email, address, preferredContact]);

    const handleSubmit = useCallback(async (e: React.FormEvent) => {
        e.preventDefault();

        if (selectedService === 'Очистка воды') {
            if (!file) {
                setFileError('Необходимо прикрепить файл анализа');
                return;
            }
            if (fileError) return;
        }

        const errors = validateForm();
        if (errors.length > 0) {
            alert('Пожалуйста, проверьте следующие поля: ' + errors.join(', '));
            return;
        }

        let fileUrl = '';
        if (file) {
            const formData = new FormData();
            formData.append('file', file);

            try {
                const uploadResponse = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData,
                });
                const uploadData = await uploadResponse.json();
                fileUrl = uploadData.url;
            } catch (error) {
                console.error('Ошибка загрузки файла:', error);
                alert('Ошибка при загрузке файла');
                return;
            }
        }

        try {
            const response = await fetch(`${SUPABASE_URL}/rest/v1/requests`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "apikey": SUPABASE_KEY,
                    "Authorization": `Bearer ${SUPABASE_KEY}`,
                    "Prefer": "return=representation"
                },
                body: JSON.stringify({
                    name,
                    phone,
                    email,
                    address,
                    service: selectedService,
                    file_url: fileUrl,
                    preferred_contact: preferredContact
                })
            });

            if (!response.ok) throw new Error(await response.text());

            await fetch('/api/telegramNotify', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name,
                    phone,
                    email,
                    address,
                    service: selectedService,
                    file_url: fileUrl,
                    preferred_contact: preferredContact
                })
            });

            setSubmittedName(name);
            setIsModalOpen(true);
            resetForm();
        } catch (error) {
            console.error("Ошибка отправки формы:", error);
        }
    }, [name, phone, email, address, validateForm, file, fileError, selectedService, preferredContact]);

    const resetForm = () => {
        setName('');
        setPhone('');
        setEmail('');
        setAddress('');
        setAddressSuggestions([]);
        setPreferredContact('');
    };

    const handleAddressChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {
        const value = e.target.value;
        setAddress(value);

        const controller = new AbortController();
        fetchAddressSuggestions(value, controller.signal);

        return () => controller.abort();
    }, [fetchAddressSuggestions]);

    return (
        <section id="price-form-section" className="container mx-auto px-4 py-8 relative">
            {isModalOpen && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fadeIn"
                    onClick={() => setIsModalOpen(false)}>
                    <div className="bg-white rounded-2xl p-8 max-w-md w-[90%] relative">
                        <button onClick={() => setIsModalOpen(false)}
                            className="absolute top-4 right-4 text-[#666] hover:text-[#218CE9]">
                            <FiX size={24} />
                        </button>
                        <div className="text-center">
                            <FiCheckCircle className="text-[#218CE9] w-16 h-16 mx-auto mb-4" />
                            <h3 className="text-2xl font-bold text-[#218CE9] mb-2">Заявка принята!</h3>
                            <p className="text-[#666]">Спасибо, {submittedName}! Мы свяжемся с вами в ближайшее время.</p>
                        </div>
                    </div>
                </div>
            )}

            <h2 className="text-2xl md:text-3xl font-bold text-[#218CE9] mb-4 text-center">
                Оставьте заявку
            </h2>

            <div className="bg-[#F5F5F5] rounded-xl mx-auto px-4 py-8">
                <form onSubmit={handleSubmit} className="space-y-6 max-w-2xl mx-auto">
                    <div className="relative">
                        <label className="block text-sm font-medium text-[#666] mb-2 ml-4">
                            Выберите услугу
                        </label>
                        <div className="relative">
                            <select
                                value={selectedService}
                                onChange={(e) => setSelectedService(e.target.value)}
                                className="w-full pl-12 pr-4 py-4 border-2 border-[#218CE9]/20 rounded-[62px] 
                        bg-white text-gray-700 focus:ring-2 focus:ring-[#218CE9]
                        appearance-none focus:outline-none"
                                required
                            >
                                <option value="">-- Выберите услугу --</option>
                                {services.map((service, index) => (
                                    <option key={index} value={service}>{service}</option>
                                ))}
                            </select>
                            <FiChevronDown className="absolute right-4 top-1/2 -translate-y-1/2 text-[#666]" />
                        </div>
                    </div>

                    {/* Новое поле для выбора способа связи */}
                    <div className="relative">
                        <label className="block text-sm font-medium text-[#666] mb-2 ml-4">
                            Выберите предпочитаемый способ связи
                        </label>
                        <div className="relative">
                            <select
                                value={preferredContact}
                                onChange={(e) => setPreferredContact(e.target.value)}
                                className="w-full pl-12 pr-4 py-4 border-2 border-[#218CE9]/20 rounded-[62px] bg-white text-gray-700 focus:ring-2 focus:ring-[#218CE9] appearance-none focus:outline-none"
                                required
                            >
                                <option value="">-- Выберите способ связи --</option>
                                <option value="phone">Звонок по номеру телефона</option>
                                <option value="telegram">Telegram</option>
                                <option value="whatsapp">WhatsApp</option>
                            </select>
                            <FiChevronDown className="absolute right-4 top-1/2 -translate-y-1/2 text-[#666]" />
                        </div>
                    </div>

                    {[
                        {
                            icon: FiUser,
                            placeholder: 'Ваше имя',
                            component: (
                                <IMaskInput
                                    mask={/^[A-Za-zА-Яа-яЁё\s-]*$/}
                                    placeholder="Ваше имя"
                                    value={name}
                                    onAccept={(value) => setName(value)}
                                    className="w-full pl-12 pr-4 py-4 border border-[#ddd] rounded-[62px] focus:outline-none focus:border-[#218CE9]"
                                    required
                                />
                            )
                        },
                        {
                            icon: FiPhone,
                            placeholder: '+7 (___) ___-____',
                            component: (
                                <IMaskInput
                                    mask="+7 (000) 000-0000"
                                    placeholder="+7 (___) ___-____"
                                    value={phone}
                                    onAccept={(value) => setPhone(value.toString())}
                                    className="w-full pl-12 pr-4 py-4 border border-[#ddd] rounded-[62px] focus:outline-none focus:border-[#218CE9]"
                                    required
                                />
                            )
                        },
                        {
                            icon: FiMail,
                            placeholder: 'Ваш email',
                            component: (
                                <IMaskInput
                                    mask={/^[\w-.@]*$/}
                                    placeholder="Ваш email"
                                    value={email}
                                    onAccept={(value) => {
                                        if (value.length <= 254) setEmail(value);
                                    }}
                                    className="w-full pl-12 pr-4 py-4 border border-[#ddd] rounded-[62px] focus:outline-none focus:border-[#218CE9]"
                                    required
                                />
                            )
                        },
                        {
                            icon: FiMapPin,
                            placeholder: 'Адрес проведения работ',
                            component: (
                                <input
                                    type="text"
                                    placeholder="Адрес проведения работ"
                                    value={address}
                                    onChange={handleAddressChange}
                                    className="w-full pl-12 pr-4 py-4 border border-[#ddd] rounded-[62px] focus:outline-none focus:border-[#218CE9]"
                                    required
                                />
                            ),
                            suggestions: addressSuggestions
                        }
                    ].map((field, index) => (
                        <div key={index} className="relative">
                            <field.icon className="absolute left-4 top-1/2 -translate-y-1/2 text-[#666]" />
                            {field.component}
                            {field.suggestions && field.suggestions.length > 0 && (
                                <ul className="absolute bg-white border border-[#ddd] rounded-lg mt-2 w-full shadow-md z-10">
                                    {field.suggestions.map((suggestion, idx) => (
                                        <li
                                            key={idx}
                                            className="p-2 hover:bg-[#f0f0f0] cursor-pointer"
                                            onClick={() => {
                                                setAddress(suggestion);
                                                setAddressSuggestions([]);
                                            }}
                                        >
                                            {suggestion}
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>
                    ))}

                    <div className="relative">
                        {selectedService === 'Очистка воды' && (
                            <label className="block text-sm font-medium text-[#666] mb-2 ml-4">
                                Прикрепить файл (анализ воды) *
                            </label>
                        )}

                        {selectedService === 'Очистка воды' && (
                            <div className="relative group">
                                <input
                                    type="file"
                                    onChange={handleFileUpload}
                                    className="w-full opacity-0 absolute z-20 cursor-pointer h-full"
                                    id="fileInput"
                                    accept=".pdf,.doc,.docx,image/*"
                                    required
                                />
                                <label
                                    htmlFor="fileInput"
                                    className="block w-full pl-12 pr-4 py-4 border-2 border-[#218CE9]/20 
          rounded-[62px] bg-white text-gray-400 cursor-pointer
          group-hover:border-[#218CE9]/40 transition-all"
                                >
                                    {file ? file.name : 'Выберите файл...'}
                                </label>
                                <FiUpload className="absolute left-4 top-1/2 -translate-y-1/2 text-[#666]" />
                            </div>
                        )}

                        {fileError && (
                            <p className="text-red-500 text-sm mt-2 ml-4">{fileError}</p>
                        )}

                        {file && (
                            <p className="text-green-600 text-sm mt-2 ml-4">
                                ✓ Файл загружен: {file.name}
                            </p>
                        )}
                    </div>

                    <button
                        type="submit"
                        disabled={isSubmitting}
                        className={`w-full py-4 rounded-[62px] font-bold transition-colors ${isSubmitting
                            ? 'bg-gray-400 cursor-not-allowed'
                            : 'bg-[#218CE9] text-white hover:bg-[#1a70c0]'
                            }`}
                    >
                        {isSubmitting ? 'Отправка...' : 'Отправить заявку'}
                    </button>
                </form>
            </div>
        </section>
    );
};

export default PriceForm;
// components/SchemaOrganization.tsx
export const SchemaOrganization = () => (
    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "АкваСервис",
        "url": "https://aqua-service-karelia.ru/",
        "logo": "https://aqua-service-karelia.ru/images/logo.png",
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+7-8142-27-05-45",
          "contactType": "customer service"
        }
      })}
    </script>
  );// components/ServiceCard.tsx
'use client';
import Image from "next/image";
import Link from 'next/link';

interface Service {
  id: number;
  title: string;
  description: string;
  price: number;
  image_url: string;
  area_served: string[] | null;
  slug: string;
}

interface ServiceCardProps {
  service: Service;
}

export default function ServiceCard({ service }: ServiceCardProps) {
  // Создаем безопасную версию массива
  const areas = service.area_served || [];

  return (
    <Link
      href={`/services/${service.slug}`}
      className="..."
    >
      <div className="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow flex flex-col h-full">

        <div itemScope itemType="https://schema.org/Service">
          <meta itemProp="serviceType" content={service.title} />
          <div itemProp="provider" itemScope itemType="https://schema.org/Organization">
            <meta itemProp="name" content="АкваСервис" />
          </div>
          {areas.map((area, i) => (
            <meta key={i} itemProp="areaServed" content={area} />
          ))}
        </div>

        {service.image_url && (
          <div className="relative h-48 w-full overflow-hidden rounded-t-lg">
            <Image
              src={service.image_url}
              alt={service.title}
              fill
              className="object-cover"
              sizes="(max-width: 768px) 100vw, 33vw"
              itemProp="image"
            />
          </div>
        )}

        <div className="p-6 flex flex-col flex-grow">
          <h2 className="text-xl font-bold text-[#218CE9] mb-2" itemProp="name">
            {service.title}
          </h2>

          <p className="text-gray-600 mb-4 flex-grow" itemProp="description">
            {service.description}
          </p>

          <div className="mt-auto">
            <span
              className="font-bold text-[#218CE9] text-lg"
              itemProp="offers"
              itemScope
              itemType="https://schema.org/Offer"
            >
              <meta itemProp="priceCurrency" content="RUB" />
              <span itemProp="price">{service.price.toLocaleString('ru-RU')}</span> ₽
            </span>

            {/* Безопасное отображение городов */}
            <div className="mt-2 text-sm text-gray-500">
              Доступно в: {areas.length > 0 ? areas.join(', ') : 'Все регионы'}
            </div>
          </div>
        </div>
      </div>
    </Link>

  );
}// components/ServicesSlider.tsx - Слайдер услуг на главной странице (app/page.tsx)
"use client";
import React, { useEffect, useState } from "react";
import useEmblaCarousel from "embla-carousel-react";
import Autoplay from "embla-carousel-autoplay";
import { WheelGesturesPlugin } from "embla-carousel-wheel-gestures";
import Image from "next/image";
import Link from "next/link";
import { supabase } from '@/lib/supabase';

// Тип данных для услуг из Supabase
interface Service {
  id: string;
  title: string;
  description: string;
  price: string;
  image_url: string;
}

const ServicesSlider = () => {
  // Состояния компонента
  const [services, setServices] = useState<Service[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedIndex, setSelectedIndex] = useState(0);

  // Инициализация слайдера
  const [emblaRef, emblaApi] = useEmblaCarousel(
    {
      loop: true,
      align: "start",
      breakpoints: {
        "(min-width: 640px)": { slidesToScroll: 1 },
        "(min-width: 1024px)": { slidesToScroll: 1 }
      }
    },
    [Autoplay({ delay: 5000 }), WheelGesturesPlugin()]
  );

  // Загрузка данных при монтировании
  useEffect(() => {
    const fetchServices = async () => {
      console.log('Fetching services...');
      try {
        const { data, error } = await supabase
          .from('services')
          .select('*');  
        console.log('Data received:', data);
  
        if (error) throw error;
        setServices(data || []);
      } catch (err) {
        console.error('Ошибка загрузки:', JSON.stringify(err, null, 2));
        setError('Не удалось загрузить услуги');
      } finally {
        setLoading(false);
      }
    };
  
    fetchServices();
  }, []);

  // Обработчик изменения слайда
  useEffect(() => {
    if (!emblaApi) return;
    const updateIndex = () => setSelectedIndex(emblaApi.selectedScrollSnap());
    emblaApi.on("select", updateIndex);
    return () => {
      emblaApi.off("select", updateIndex);
    };
  }, [emblaApi]);
  

  // Состояния загрузки
  if (loading) {
    return (
      <div className="text-center py-12">
        <div className="animate-spin inline-block w-8 h-8 border-4 rounded-full border-t-blue-500"></div>
      </div>
    );
  }

  // Обработка ошибок
  if (error) {
    return (
      <div className="text-red-500 text-center py-8">
        {error}. Попробуйте обновить страницу
      </div>
    );
  }

  return (
    <section className="px-4 py-8 container mx-auto">
      <div className="border-b border-black/10 mb-8"></div>
      
      <h2 className="text-center font-bold text-3xl text-[#218CE9] mb-8">
        НАШИ УСЛУГИ
      </h2>

      <div className="flex items-center gap-4">
        {/* Кнопка назад */}
        <button
          onClick={() => emblaApi?.scrollPrev()}
          className="hidden md:flex items-center justify-center w-10 h-10 rounded-full bg-white shadow-lg hover:scale-110 transition-transform"
        >
          <svg className="w-6 h-6 text-[#218CE9]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>

        {/* Контейнер слайдов */}
        <div className="embla overflow-hidden flex-1" ref={emblaRef}>
          <div className="embla__container flex gap-3">
            {services.map((service) => (
              <div 
                className="embla__slide flex-[0_0_280px]" 
                key={service.id}
              >
                <article className="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow h-full flex flex-col">
                  <div className="relative h-60">
                    <Image
                      src={service.image_url}
                      alt={service.title}
                      fill
                      className="object-cover rounded-t-xl"
                      sizes="(max-width: 768px) 100vw, 50vw"
                    />
                  </div>
                  
                  <div className="p-4 flex flex-col flex-grow">
                    <h3 className="text-xl font-bold text-[#218CE9] mb-2">
                      {service.title}
                    </h3>
                    
                    <p className="text-gray-600 text-sm mb-4 flex-grow">
                      {service.description}
                    </p>

                    <div className="mt-auto">
                      <p className="text-lg font-bold text-[#218CE9] mb-3">
                        от {service.price} ₽
                      </p>
                      <button className="w-full bg-[#218CE9] text-white py-2 rounded-lg hover:bg-[#1a6fb9] transition-colors">
                        Заказать
                      </button>
                    </div>
                  </div>
                </article>
              </div>
            ))}
          </div>
        </div>

        {/* Кнопка вперед */}
        <button
          onClick={() => emblaApi?.scrollNext()}
          className="hidden md:flex items-center justify-center w-10 h-10 rounded-full bg-white shadow-lg hover:scale-110 transition-transform"
        >
          <svg className="w-6 h-6 text-[#218CE9]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </div>

      {/* Пагинация */}
      <div className="flex justify-center gap-2 mt-6">
        {services.map((_, index) => (
          <button
            key={index}
            onClick={() => emblaApi?.scrollTo(index)}
            className={`w-2 h-2 rounded-full transition-opacity ${
              selectedIndex === index ? 'opacity-100' : 'opacity-30'
            } bg-[#218CE9]`}
          />
        ))}
      </div>

      {/* Кнопка "Посмотреть все" */}
      <div className="flex justify-center mt-8">
        <Link
          href="/services"
          className="bg-[#218CE9] text-white px-6 py-2 rounded-full hover:bg-[#1a6fb9] transition-colors"
        >
          Все услуги →
        </Link>
      </div>
    </section>
  );
};

export default ServicesSlider;// src/app/components/WorkSteps.tsx
'use client'
import React from 'react'

interface Step {
  title: string;
  content: React.ReactNode;
}

interface WorkStepsProps {
  steps?: Step[];
  title?: string;
  subtitle?: string;
}

const WorkSteps: React.FC<WorkStepsProps> = ({
  steps,
  title = "КАК МЫ РАБОТАЕМ",
  subtitle = "Этапы работы — от заявки до чистой воды"
}) => {
  const defaultSteps: Step[] = [
    {
      title: 'Выезд инженера',
      content: (
        <ul className="list-disc pl-5 space-y-2">
          <li>Анализ грунта, подбор типа скважины</li>
        </ul>
      )
    },
    {
      title: 'Заключение договора',
      content: (
        <ul className="list-disc pl-5 space-y-2">
          <li>Фиксируем сроки, стоимость, гарантии.</li>
          <li>Без скрытых платежей.</li>
        </ul>
      )
    },
    {
      title: 'Бурение и обустройство',
      content: (
        <ul className="list-disc pl-5 space-y-2">
          <li>Используем сертифицированные материалы</li>
          <li>Минимизируем шум и грязь</li>
        </ul>
      )
    },
    {
      title: 'Пусконаладочные работы',
      content: (
        <ul className="list-disc pl-5 space-y-2">
          <li>Проверяем дебет воды</li>
          <li>Устанавливаем оборудование</li>
        </ul>
      )
    },
    {
      title: 'Сдача объекта',
      content: (
        <ul className="list-disc pl-5 space-y-2">
          <li>Подписываем акт приемки</li>
          <li>Выдаем паспорт скважины</li>
        </ul>
      )
    }
  ];

  const displayedSteps = steps || defaultSteps;

  return (
    <section className="container mx-auto px-4 py-8">
      <div className="border-b border-black border-opacity-10 mb-8"></div>

      <h2 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-6">
        {title}
      </h2>
      
      <h3 className="text-xl text-center text-[#666] mb-8">
        {subtitle}
      </h3>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
        {displayedSteps.slice(0, 3).map((step, index) => (
          <div 
            key={index}
            className="bg-[#F5F5F5] rounded-xl p-6 shadow-lg flex flex-col h-full"
          >
            <div className="flex gap-4 mb-4 items-center">
              <div className="w-8 h-8 bg-[#218CE9] text-white rounded-full flex items-center justify-center flex-shrink-0">
                {index + 1}
              </div>
              <h4 className="text-xl font-bold text-[#218CE9]">
                {step.title}
              </h4>
            </div>
            <div className="text-[#666] flex-grow">
              {step.content}
            </div>
          </div>
        ))}

        <div className="lg:col-span-3 flex flex-col lg:flex-row gap-8">
          {displayedSteps.slice(3).map((step, index) => (
            <div 
              key={index + 3}
              className="bg-[#F5F5F5] rounded-xl p-6 shadow-lg flex flex-col h-full w-full"
            >
              <div className="flex gap-4 mb-4 items-center">
                <div className="w-8 h-8 bg-[#218CE9] text-white rounded-full flex items-center justify-center flex-shrink-0">
                  {index + 4}
                </div>
                <h4 className="text-xl font-bold text-[#218CE9]">
                  {step.title}
                </h4>
              </div>
              <div className="text-[#666] flex-grow">
                {step.content}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )
}

export default WorkSteps'use client';

import React from 'react';
import { FiPhone, FiMail, FiClock, FiMapPin } from 'react-icons/fi';
import Header from '../components/Header';
import Footer from '../components/Footer';
import PriceForm from '../components/PriceForm';

const Contacts = () => {
    return (
        <main>
            <Header />
            <section className="container mx-auto px-4 py-8">
                <h1 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-8">
                    Контакты
                </h1>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    {/* Карта */}
                    <div className="w-full h-96 rounded-xl overflow-hidden shadow-lg">
                        <iframe
                            src="https://yandex.ru/map-widget/v1/?um=constructor%3Aa5d1ac1797b0f6495261d3999174b7537d534d7820055f091a55f92f5dbc663e&amp;source=constructor"
                            width="100%"
                            height="100%"
                            frameBorder="0"
                            allowFullScreen
                            title="Расположение офиса"
                        />
                    </div>

                    {/* Контактная информация */}
                    <div className="bg-[#F5F5F5] p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold text-[#218CE9] mb-4">Наш офис</h2>
                        <div className="space-y-4 text-gray-700">
                            <div className="flex items-center gap-2">
                                <FiMapPin className="text-[#218CE9]" />
                                <span>Петрозаводск, ул. Коммунистов, д.50, стр.2</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <FiPhone className="text-[#218CE9]" />
                                <a href="tel:8142270545" className="hover:text-[#218CE9]">8 (8142) 27-05-45</a>
                            </div>
                            <div className="flex items-center gap-2">
                                <FiPhone className="text-[#218CE9]" />
                                <a href="tel:8142330090" className="hover:text-[#218CE9]">8 (8142) 33-00-90</a>
                            </div>
                            <div className="flex items-center gap-2">
                                <FiMail className="text-[#218CE9]" />
                                <a href="mailto:info@aqua-ptz.ru" className="hover:text-[#218CE9]">info@aqua-ptz.ru</a>
                            </div>
                            <div className="flex items-center gap-2">
                                <FiClock className="text-[#218CE9]" />
                                <span>пн—пт: 09:00—18:00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <PriceForm />
            <Footer/>
        </main>

    );
};

export default Contacts;
// app/equipment/page.tsx
import { supabase } from '@/lib/supabase';
import Header from "../components/Header";
import EquipmentCategoryCard from "../components/EquipmentCategoryCard";

interface Category {
  name: string;
  image_url: string | null;
  description?: string;
}

async function getCategoriesWithImages(): Promise<Category[]> {
  try {
    // Получаем уникальные категории из оборудования
    const { data: equipmentData, error: equipmentError } = await supabase
      .from('equipment')
      .select('category')
      .not('category', 'is', null)
      .order('category', { ascending: true });

    if (equipmentError) throw equipmentError;

    // Извлекаем уникальные имена категорий
    const uniqueCategories = Array.from(new Set(
      equipmentData?.map(item => item.category)
    )).filter(Boolean);

    // Получаем полные данные категорий из таблицы categories
    const { data: categoriesData, error: categoriesError } = await supabase
      .from('categories')
      .select('name, image_url, description')
      .in('name', uniqueCategories)
      .order('name', { ascending: true });

    if (categoriesError) throw categoriesError;

    return categoriesData || [];
  } catch (error) {
    console.error("Ошибка загрузки категорий:", error);
    return [];
  }
}

export default async function EquipmentPage() {
  const categories = await getCategoriesWithImages();

  return (
    <main>
      <Header />
      <section className="container mx-auto px-4 py-8">
        <h1 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-8">
          Категории оборудования
        </h1>

        {categories.length > 0 ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {categories.map((category) => (
              <EquipmentCategoryCard 
                key={category.name}
                category={category}
              />
            ))}
          </div>
        ) : (
          <div className="text-center text-red-500 py-8">
            Категории временно недоступны
          </div>
        )}
      </section>
    </main>
  );
}// app/equipment/[category]/page.tsx
import { supabase } from '@/lib/supabase';
import EquipmentCard from '../../components/EquipmentCard';
import Image from 'next/image';
import type { Metadata } from 'next';
import Header from '../../components/Header';

export const dynamicParams = false;

// Генерация метаданных
export async function generateMetadata({
    params,
}: {
    params: Promise<{ category: string }>;
}): Promise<Metadata> {
    const { category } = await params;
    return {
        title: `${category} | АкваСервис`,
        description: `Оборудование для ${category}`,
    };
}

interface CategoryPageParams {
    params: Promise<{ category: string }>;
}

export default async function CategoryPage({ params }: CategoryPageParams) {
    const { category } = await params;
    const decodedCategory = decodeURIComponent(category);

    // Получаем данные категории
    const { data: categoryData } = await supabase
        .from('categories')
        .select('*')
        .ilike('name', decodedCategory)
        .single();

    // Получаем оборудование категории
    const { data: equipmentData } = await supabase
        .from('equipment')
        .select('*')
        .ilike('category', decodedCategory)
        .order('price', { ascending: true });

    if (!categoryData) {
        return (
            <>
                <Header />
                <section className="container mx-auto px-4 py-8">
                    <div className="text-center text-red-500 py-8">
                        Категория не найдена
                    </div>
                </section>
            </>
        );
    }

    return (
        <>
            <Header />
            <section className="container mx-auto px-4 py-8">

                {/* Шапка категории */}
                <div className="mb-8">
                    <div className="relative h-64 w-full rounded-xl overflow-hidden shadow-lg">
                        <Image
                            src={categoryData.image_url}
                            alt={categoryData.name}
                            fill
                            className="object-cover"
                            sizes="(max-width: 768px) 100vw, 80vw"
                            priority
                        />
                        <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />
                        <div className="absolute bottom-4 left-4 right-4">
                            <h1 className="text-3xl md:text-4xl font-bold text-white">
                                {categoryData.name}
                            </h1>
                            {categoryData.description && (
                                <p className="text-gray-200 mt-2 max-w-xl">
                                    {categoryData.description}
                                </p>
                            )}
                        </div>
                    </div>
                </div>

                {/* Список оборудования */}
                {equipmentData?.length ? (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {equipmentData.map((item) => (
                            <EquipmentCard key={item.id} equipment={item} />
                        ))}
                    </div>
                ) : (
                    <div className="text-center text-red-500 py-8">
                        В этой категории пока нет оборудования
                    </div>
                )}
            </section>
        </>
    );
}

// Генерация статических параметров
export async function generateStaticParams() {
    const { data: categories } = await supabase
        .from('categories')
        .select('name');

    return (categories || []).map(({ name }) => ({
        category: name,
    }));
}
// app/equipment/[category]/page.tsx
import { supabase } from '@/lib/supabase';
import EquipmentCard from '../../components/EquipmentCard';
import Image from 'next/image';

export default async function CategoryPage({
    params,
}: {
    params: { category: string };
}) {
    const decodedCategory = decodeURIComponent(params.category);

    // Получаем данные категории
    const { data: categoryData } = await supabase
        .from('categories')
        .select('*')
        .eq('name', decodedCategory)
        .single();

    // Получаем оборудование категории
    const { data: equipmentData } = await supabase
        .from('equipment')
        .select('*')
        .eq('category', decodedCategory)
        .order('price', { ascending: true });

    if (!categoryData) {
        return (
            <section className="container mx-auto px-4 py-8">
                <div className="text-center text-red-500 py-8">
                    Категория не найдена
                </div>
            </section>
        );
    }

    return (
        <section className="container mx-auto px-4 py-8">
            {/* Шапка категории */}
            <div className="mb-8">
                <div className="relative h-64 w-full rounded-xl overflow-hidden shadow-lg">
                    <Image
                        src={categoryData.image_url}
                        alt={categoryData.name}
                        fill
                        className="object-cover"
                        sizes="(max-width: 768px) 100vw, 80vw"
                        priority
                    />
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent" />
                    <div className="absolute bottom-4 left-4 right-4">
                        <h1 className="text-3xl md:text-4xl font-bold text-white">
                            {categoryData.name}
                        </h1>
                        {categoryData.description && (
                            <p className="text-gray-200 mt-2 max-w-xl">
                                {categoryData.description}
                            </p>
                        )}
                    </div>
                </div>
            </div>

            {/* Список оборудования */}
            {equipmentData?.length ? (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {equipmentData.map((item) => (
                        <EquipmentCard key={item.id} equipment={item} />
                    ))}
                </div>
            ) : (
                <div className="text-center text-red-500 py-8">
                    В этой категории пока нет оборудования
                </div>
            )}
        </section>
    );
}

export async function generateStaticParams() {
    const { data: categories } = await supabase
        .from('categories')
        .select('name');

    return categories?.map(({ name }) => ({
        category: encodeURIComponent(name),
    })) || [];
}import { supabase } from '@/lib/supabase';
import Header from '@/src/app/components/Header';
import Image from "next/image";
import Link from "next/link";
import Footer from '@/src/app/components/Footer';
import { FiArrowRight, FiCheckCircle } from "react-icons/fi";
import PriceForm from '@/src/app/components/PriceForm';

interface Equipment {
    id: number;
    title: string;
    description: string;
    description_full?: string;
    price: number;
    image_url: string;
    category: string;
    slug: string;
    specifications?: string[] | Record<string, string>;
    warranty?: number;
    manufacturer?: string;
}

interface Category {
    id: number;
    name: string;
    slug: string;
}

export async function generateStaticParams() {
    const { data: equipment } = await supabase
        .from('equipment')
        .select('slug, category');

    return equipment?.map((item) => ({
        category: item.category,
        slug: item.slug,
    })) || [];
}

async function getEquipment(slug: string): Promise<Equipment> {
    const { data, error } = await supabase
        .from('equipment')
        .select('*')
        .eq('slug', slug)
        .single();

    if (error) throw error;
    return data as Equipment;
}

async function getCategory(name: string): Promise<Category | null> {
    const { data } = await supabase
        .from('categories')
        .select('*')
        .eq('name', name)
        .single();

    return data;
}

type Params = Promise<{ category: string; slug: string }>;

export default async function EquipmentPage({ params }: { params: Params }) {
    try {
        const resolvedParams = await params;
        const { category, slug } = resolvedParams;
        const decodedCategory = decodeURIComponent(category); // Декодируем category

        const [equipment, categoryData] = await Promise.all([
            getEquipment(slug),
            getCategory(decodedCategory) // Используем декодированную категорию
        ]);

        return (
            <main className="min-h-screen bg-gradient-to-b from-white to-blue-50">
                <Header />

                <section className="container mx-auto px-4 py-8 md:py-12">
                    <nav className="mb-6 md:mb-8 text-sm text-gray-600">
                        <ol className="flex flex-wrap items-center gap-2">
                            <li><Link href="/" className="hover:text-[#218CE9] transition-colors">Главная</Link></li>
                            <li><FiArrowRight className="text-[#218CE9]/60" /></li>
                            <li><Link href="/equipment" className="hover:text-[#218CE9] transition-colors">Оборудование</Link></li>
                            <li><FiArrowRight className="text-[#218CE9]/60" /></li>
                            <li>
                                <Link
                                    href={`/equipment/${category}`}
                                    className="hover:text-[#218CE9] transition-colors"
                                >
                                    {categoryData?.name || category}
                                </Link>
                            </li>
                            <li><FiArrowRight className="text-[#218CE9]/60" /></li>
                            <li className="text-[#218CE9] font-medium truncate max-w-[200px]">
                                {equipment.title}
                            </li>
                        </ol>
                    </nav>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                        <div className="relative aspect-square rounded-2xl overflow-hidden shadow-xl">
                            <Image
                                src={equipment.image_url}
                                alt={equipment.title}
                                fill
                                className="object-cover"
                                sizes="(max-width: 768px) 100vw, 50vw"
                                priority
                            />
                        </div>

                        <div className="space-y-6">
                            <div className="space-y-4">
                                <h1 className="text-3xl md:text-4xl font-bold text-[#218CE9]">
                                    {equipment.title}
                                </h1>
                                <div className="text-2xl font-bold text-gray-800">
                                    Цена: {equipment.price.toLocaleString('ru-RU')} ₽
                                </div>
                                {equipment.description && (
                                    <div className="prose prose-lg text-gray-600">
                                        <p>{equipment.description}</p>
                                    </div>
                                )}
                            </div>

                            <div className="bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-[#218CE9]/10">
                                <div className="flex items-baseline gap-4 mb-6">
                                    <FiCheckCircle className="text-[#218CE9] text-xl" />
                                    <h2 className="text-2xl font-bold text-gray-800">Характеристики</h2>
                                </div>

                                {equipment.specifications && (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {Array.isArray(equipment.specifications) ? (
                                            equipment.specifications.map((spec: string, index: number) => (
                                                <div key={index} className="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
                                                    <FiCheckCircle className="text-[#218CE9] flex-shrink-0" />
                                                    <span className="text-gray-600">{spec}</span>
                                                </div>
                                            ))
                                        ) : (
                                            Object.entries(equipment.specifications).map(([key, value]: [string, string], index: number) => (
                                                <div key={index} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                                    <span className="text-gray-600 font-medium">{key}</span>
                                                    <span className="text-[#218CE9] font-semibold">{value}</span>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                )}

                                {(equipment.warranty || equipment.manufacturer) && (
                                    <div className="mt-8 pt-6 border-t border-[#218CE9]/10">
                                        <div className="grid grid-cols-2 gap-4">
                                            {equipment.manufacturer && (
                                                <div className="flex items-center gap-2">
                                                    <FiCheckCircle className="text-[#218CE9]" />
                                                    <div>
                                                        <p className="text-sm text-gray-500">Производитель</p>
                                                        <p className="font-medium">{equipment.manufacturer}</p>
                                                    </div>
                                                </div>
                                            )}
                                            {equipment.warranty && (
                                                <div className="flex items-center gap-2">
                                                    <FiCheckCircle className="text-[#218CE9]" />
                                                    <div>
                                                        <p className="text-sm text-gray-500">Гарантия</p>
                                                        <p className="font-medium">{equipment.warranty} мес</p>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {equipment.description_full && (
                        <div className="mt-12 prose prose-lg max-w-none bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-[#218CE9]/10">
                            <h3 className="text-2xl font-bold text-[#218CE9] mb-4">
                                Подробное описание
                            </h3>
                            <p className="text-gray-600">{equipment.description_full}</p>
                        </div>
                    )}
                </section>

                <PriceForm />
                <Footer />
            </main>
        );
    } catch (error) {
        console.error('Ошибка загрузки оборудования:', error);
        return (
            <main>
                <Header />
                <div className="container mx-auto px-4 py-8 text-center text-red-500">
                    Оборудование не найдено
                </div>
            </main>
        );
    }
}'use client'

import { Suspense } from 'react'
import { useSearchParams } from 'next/navigation'

function SearchResults() {
  const searchParams = useSearchParams()
  const query = searchParams.get('q') || ''

  return (
    <div>
      <h1>Результаты поиска для: {query}</h1>
      {/* ... */}
    </div>
  )
}

export default function SearchPage() {
  return (
    <Suspense fallback={<div>Загрузка...</div>}>
      <SearchResults />
    </Suspense>
  )
}// app/search/SearchResults.tsx (Клиентский компонент)
'use client'

import { useSearchParams } from 'next/navigation'

export default function SearchResults() {
  const searchParams = useSearchParams()
  const query = searchParams.get('q') || ''

  return (
    <div>
      <h1>Результаты поиска для: {query}</h1>
      {/* Остальная клиентская логика */}
    </div>
  )
}// app/services/page.tsx
import { supabase } from '@/lib/supabase';
import Header from "../components/Header";
import ServiceCard from "../components/ServiceCard";

interface Service {
  id: number;
  title: string;
  description: string;
  price: number;
  image_url: string;
  area_served: string[];
  slug: string;
}

async function getServices(): Promise<Service[]> {
  const { data, error } = await supabase
    .from('services')
    .select('*')
    .order('price', { ascending: true });

  if (error) throw error;
  return data || [];
}

export default async function ServicesPage() {
  const services = await getServices();

  return (
    <main>
      <Header />
      <section className="container mx-auto px-4 py-8">
        <h1 className="text-3xl md:text-4xl font-bold text-[#218CE9] text-center mb-8">
          Наши услуги
        </h1>

        {services.length > 0 ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {services.map((service) => (
              <ServiceCard
                key={service.id}
                service={service}
              />
            ))}
          </div>
        ) : (
          <div className="text-center text-red-500 py-8">
            Услуги временно недоступны
          </div>
        )}
      </section>
    </main>
  );
}// app/services/[city]/page.tsx
import { supabase } from '@/lib/supabase';
import Header from "../../../components/Header";
import ServiceCard from "../../../components/ServiceCard";

export async function generateStaticParams() {
    const { data: services } = await supabase
        .from('services')
        .select('area_served');

    const cities = Array.from(new Set(
        services?.flatMap(s => s.area_served)
    )).filter(Boolean);

    return cities.map(city => ({
        city: encodeURIComponent(city)
    }));
}

export default async function CityServices({
    params
  }: {
    params: Promise<{ city: string }>
  }) {
    const { city } = await params;
    const decodedCity = decodeURIComponent(city);

    const { data: services } = await supabase
        .from('services')
        .select('*')
        .contains('area_served', [decodedCity]);

    return (
        <main>
            <Header />
            <div className="container mx-auto px-4 py-8">
                <h1 className="text-3xl font-bold mb-8 text-center">
                    Услуги в {decodedCity}
                </h1>

                {services && services.length > 0 ? (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {services.map((service) => (
                            <ServiceCard
                                key={service.id}
                                service={service}
                            />
                        ))}
                    </div>
                ) : (
                    <div className="text-center text-red-500 py-8">
                        Нет услуг для данного региона
                    </div>
                )}
            </div>
        </main>
    );
}import { supabase } from '@/lib/supabase';
import Header from "../../components/Header";
import Image from "next/image";
import Link from "next/link";
import Footer from "../../components/Footer";
import { FiArrowRight, FiCheckCircle } from "react-icons/fi";
import PriceForm from '../../components/PriceForm';

// Генерация статических путей по slug услуги
export async function generateStaticParams() {
    const { data: services } = await supabase
        .from('services')
        .select('slug');

    return services?.map((service) => ({
        slug: service.slug,
    })) || [];
}

export default async function ServicePage({
    params
}: {
    params: Promise<{ slug: string }>
}) {
    try {
        const { slug } = await params;

        // Получение данных услуги по slug
        const { data: service, error } = await supabase
            .from('services')
            .select('*')
            .eq('slug', slug)
            .single();

        if (error || !service) {
            return (
                <main>
                    <Header />
                    <div className="container mx-auto px-4 py-8 text-center text-red-500">
                        Услуга не найдена
                    </div>
                </main>
            );
        }

        return (
            <main className="min-h-screen bg-gradient-to-b from-white to-blue-50">
                <Header />

                <section className="container mx-auto px-4 py-8 md:py-12">
                    {/* Хлебные крошки */}
                    <nav className="mb-6 md:mb-8 text-sm text-gray-600">
                        <ol className="flex flex-wrap items-center gap-2">
                            <li><Link href="/" className="hover:text-[#218CE9] transition-colors">Главная</Link></li>
                            <li><FiArrowRight className="text-[#218CE9]/60" /></li>
                            <li><Link href="/services" className="hover:text-[#218CE9] transition-colors">Услуги</Link></li>
                            <li><FiArrowRight className="text-[#218CE9]/60" /></li>
                            <li className="text-[#218CE9] font-medium truncate max-w-[200px]">{service.title}</li>
                        </ol>
                    </nav>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                        {/* Изображение */}
                        <div className="relative aspect-video lg:aspect-square rounded-2xl overflow-hidden shadow-xl">
                            <Image
                                src={service.image_url}
                                alt={service.title}
                                fill
                                className="object-cover"
                                sizes="(max-width: 768px) 100vw, 50vw"
                                priority
                            />
                            <div className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent" />
                        </div>

                        {/* Контент */}
                        <div className="space-y-6">
                            <h1 className="text-3xl md:text-4xl font-bold text-[#218CE9] mb-4">
                                {service.title}
                            </h1>

                            <div className="prose prose-lg max-w-none text-gray-600 mb-8">
                                <p className="text-lg leading-relaxed">{service.description}</p>
                            </div>

                            {/* Блок преимуществ */}
                            <div className="bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-[#218CE9]/10">
                                <div className="flex items-baseline gap-4 mb-6">
                                    <span className="text-2xl md:text-3xl font-bold text-[#218CE9]">
                                        от {service.price.toLocaleString('ru-RU')} ₽
                                    </span>
                                    <span className="text-gray-500">·</span>
                                    <span className="text-gray-600">Гарантия 2 года</span>
                                </div>

                                {service.area_served?.length > 0 && (
                                    <div className="border-t border-[#218CE9]/10 pt-6">
                                        <h3 className="text-xl font-semibold text-[#218CE9] mb-4">
                                            Доступно в регионах:
                                        </h3>
                                        <ul className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            {service.area_served.map((area: string, index: number) => (
                                                <li key={index} className="flex items-start gap-2">
                                                    <FiCheckCircle className="text-[#218CE9] mt-1 flex-shrink-0" />
                                                    <span className="text-gray-600">{area}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    <PriceForm />
                </section>

                <Footer />
            </main>
        );
    } catch (error) {
        console.error('Ошибка загрузки услуги:', error);
        return (
            <main>
                <Header />
                <div className="container mx-auto px-4 py-8 text-center text-red-500">
                    Услуга не найдена
                </div>
            </main>
        );
    }
}